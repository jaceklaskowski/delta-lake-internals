<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Demystifying inner-workings of Delta Lake"><meta name=author content="Jacek Laskowski"><link href=https://books.japila.pl/delta-lake-internals/commands/merge/MergeIntoCommand/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.3.9+insiders-4.21.0"><title>MergeIntoCommand - The Internals of Delta Lake</title><link rel=stylesheet href=../../../assets/stylesheets/main.846d444e.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-XYXVSTV57H"),document.addEventListener("DOMContentLoaded",function(){if(document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document.forms.feedback){var e,a=document.forms.feedback;for(e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}"undefined"!=typeof location$&&location$.subscribe(function(e){n("config","G-XYXVSTV57H",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-XYXVSTV57H",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mergeintocommand class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="The Internals of Delta Lake" class="md-header__button md-logo" aria-label="The Internals of Delta Lake" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Internals of Delta Lake </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> MergeIntoCommand </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/japila-books/delta-lake-internals title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> delta-lake-internals </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../overview/ class=md-tabs__link> Internals </a> </li> <li class=md-tabs__item> <a href=../../../features/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../../../DeltaDataSource/ class=md-tabs__link> Delta Data Source </a> </li> <li class=md-tabs__item> <a href=../../../DeltaTable/ class=md-tabs__link> Developer API </a> </li> <li class=md-tabs__item> <a href=../../../sql/ class=md-tabs__link> Delta SQL </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> Commands </a> </li> <li class=md-tabs__item> <a href=../../../demo/ class=md-tabs__link> Demos </a> </li> <li class=md-tabs__item> <a href=../../../ColumnWithDefaultExprUtils/ class=md-tabs__link> Misc </a> </li> <li class=md-tabs__item> <a href=../../../DeltaProgressReporter/ class=md-tabs__link> Monitoring </a> </li> <li class=md-tabs__item> <a href=../../../contenders/ class=md-tabs__link> Contenders </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="The Internals of Delta Lake" class="md-nav__button md-logo" aria-label="The Internals of Delta Lake" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg> </a> The Internals of Delta Lake </label> <div class=md-nav__source> <a href=https://github.com/japila-books/delta-lake-internals title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> delta-lake-internals </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> <span class=md-ellipsis> Internals </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Internals data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Internals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> <span class=md-ellipsis> Configuration Properties </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Configuration Properties" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Configuration Properties </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../configuration-properties/ class=md-nav__link> <span class=md-ellipsis> Configuration Properties </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaSQLConf/ class=md-nav__link> <span class=md-ellipsis> DeltaSQLConf </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../DeltaTableIdentifier/ class=md-nav__link> <span class=md-ellipsis> DeltaTableIdentifier </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5 type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5> <span class=md-ellipsis> FileFormat </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=FileFormat data-md-level=2> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> FileFormat </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../DeltaFileFormat/ class=md-nav__link> <span class=md-ellipsis> DeltaFileFormat </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaParquetFileFormat/ class=md-nav__link> <span class=md-ellipsis> DeltaParquetFileFormat </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6 type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6> <span class=md-ellipsis> Table Properties </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Table Properties" data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Table Properties </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../table-properties/ class=md-nav__link> <span class=md-ellipsis> Table Properties </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaConfigs/ class=md-nav__link> <span class=md-ellipsis> DeltaConfigs </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaConfig/ class=md-nav__link> <span class=md-ellipsis> DeltaConfig </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_7 type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7> <span class=md-ellipsis> Transaction Log (DeltaLog) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Transaction Log (DeltaLog)" data-md-level=2> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Transaction Log (DeltaLog) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../DeltaLog/ class=md-nav__link> <span class=md-ellipsis> DeltaLog </span> </a> </li> <li class=md-nav__item> <a href=../../../Operation/ class=md-nav__link> <span class=md-ellipsis> Operation </span> </a> </li> <li class=md-nav__item> <a href=../../../Checkpoints/ class=md-nav__link> <span class=md-ellipsis> Checkpoints </span> </a> </li> <li class=md-nav__item> <a href=../../../CheckpointV2/ class=md-nav__link> <span class=md-ellipsis> CheckpointV2 </span> </a> </li> <li class=md-nav__item> <a href=../../../SnapshotManagement/ class=md-nav__link> <span class=md-ellipsis> SnapshotManagement </span> </a> </li> <li class=md-nav__item> <a href=../../../ReadChecksum/ class=md-nav__link> <span class=md-ellipsis> ReadChecksum </span> </a> </li> <li class=md-nav__item> <a href=../../../MetadataCleanup/ class=md-nav__link> <span class=md-ellipsis> MetadataCleanup </span> </a> </li> <li class=md-nav__item> <a href=../../../VerifyChecksum/ class=md-nav__link> <span class=md-ellipsis> VerifyChecksum </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_8 type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8> <span class=md-ellipsis> Optimistic Transactions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Optimistic Transactions" data-md-level=2> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Optimistic Transactions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../OptimisticTransaction/ class=md-nav__link> <span class=md-ellipsis> OptimisticTransaction </span> </a> </li> <li class=md-nav__item> <a href=../../../OptimisticTransactionImpl/ class=md-nav__link> <span class=md-ellipsis> OptimisticTransactionImpl </span> </a> </li> <li class=md-nav__item> <a href=../../../TransactionalWrite/ class=md-nav__link> <span class=md-ellipsis> TransactionalWrite </span> </a> </li> <li class=md-nav__item> <a href=../../../DelayedCommitProtocol/ class=md-nav__link> <span class=md-ellipsis> DelayedCommitProtocol </span> </a> </li> <li class=md-nav__item> <a href=../../../IsolationLevel/ class=md-nav__link> <span class=md-ellipsis> IsolationLevel </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_8_6 type=checkbox id=__nav_2_8_6> <label class=md-nav__link for=__nav_2_8_6> <span class=md-ellipsis> Post-Commit Hooks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Post-Commit Hooks" data-md-level=3> <label class=md-nav__title for=__nav_2_8_6> <span class="md-nav__icon md-icon"></span> Post-Commit Hooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../PostCommitHook/ class=md-nav__link> <span class=md-ellipsis> PostCommitHook </span> </a> </li> <li class=md-nav__item> <a href=../../../GenerateSymlinkManifest/ class=md-nav__link> <span class=md-ellipsis> GenerateSymlinkManifest </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_9 type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9> <span class=md-ellipsis> (State) Snapshot </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="(State) Snapshot" data-md-level=2> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> (State) Snapshot </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Snapshot/ class=md-nav__link> <span class=md-ellipsis> Snapshot </span> </a> </li> <li class=md-nav__item> <a href=../../../InMemoryLogReplay/ class=md-nav__link> <span class=md-ellipsis> InMemoryLogReplay </span> </a> </li> <li class=md-nav__item> <a href=../../../PartitionFiltering/ class=md-nav__link> <span class=md-ellipsis> PartitionFiltering </span> </a> </li> <li class=md-nav__item> <a href=../../../LogSegment/ class=md-nav__link> <span class=md-ellipsis> LogSegment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../DeltaHistoryManager/ class=md-nav__link> <span class=md-ellipsis> DeltaHistoryManager </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_11 type=checkbox id=__nav_2_11> <div class="md-nav__link md-nav__container"> <a href=../../../storage/ class="md-nav__link "> <span class=md-ellipsis> Storage </span> </a> <label class="md-nav__link " for=__nav_2_11> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Storage data-md-level=2> <label class=md-nav__title for=__nav_2_11> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../storage/DelegatingLogStore/ class=md-nav__link> <span class=md-ellipsis> DelegatingLogStore </span> </a> </li> <li class=md-nav__item> <a href=../../../storage/LogStore/ class=md-nav__link> <span class=md-ellipsis> LogStore </span> </a> </li> <li class=md-nav__item> <a href=../../../storage/LogStoreAdaptor/ class=md-nav__link> <span class=md-ellipsis> LogStoreAdaptor </span> </a> </li> <li class=md-nav__item> <a href=../../../storage/LogStoreProvider/ class=md-nav__link> <span class=md-ellipsis> LogStoreProvider </span> </a> </li> <li class=md-nav__item> <a href=../../../storage/HadoopFileSystemLogStore/ class=md-nav__link> <span class=md-ellipsis> HadoopFileSystemLogStore </span> </a> </li> <li class=md-nav__item> <a href=../../../storage/HDFSLogStore/ class=md-nav__link> <span class=md-ellipsis> HDFSLogStore </span> </a> </li> <li class=md-nav__item> <a href=../../../storage/S3SingleDriverLogStore/ class=md-nav__link> <span class=md-ellipsis> S3SingleDriverLogStore </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_12 type=checkbox id=__nav_2_12> <label class=md-nav__link for=__nav_2_12> <span class=md-ellipsis> Actions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Actions data-md-level=2> <label class=md-nav__title for=__nav_2_12> <span class="md-nav__icon md-icon"></span> Actions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Action/ class=md-nav__link> <span class=md-ellipsis> Action </span> </a> </li> <li class=md-nav__item> <a href=../../../AddCDCFile/ class=md-nav__link> <span class=md-ellipsis> AddCDCFile </span> </a> </li> <li class=md-nav__item> <a href=../../../AddFile/ class=md-nav__link> <span class=md-ellipsis> AddFile </span> </a> </li> <li class=md-nav__item> <a href=../../../CommitInfo/ class=md-nav__link> <span class=md-ellipsis> CommitInfo </span> </a> </li> <li class=md-nav__item> <a href=../../../FileAction/ class=md-nav__link> <span class=md-ellipsis> FileAction </span> </a> </li> <li class=md-nav__item> <a href=../../../Metadata/ class=md-nav__link> <span class=md-ellipsis> Metadata </span> </a> </li> <li class=md-nav__item> <a href=../../../Protocol/ class=md-nav__link> <span class=md-ellipsis> Protocol </span> </a> </li> <li class=md-nav__item> <a href=../../../RemoveFile/ class=md-nav__link> <span class=md-ellipsis> RemoveFile </span> </a> </li> <li class=md-nav__item> <a href=../../../SetTransaction/ class=md-nav__link> <span class=md-ellipsis> SetTransaction </span> </a> </li> <li class=md-nav__item> <a href=../../../SingleAction/ class=md-nav__link> <span class=md-ellipsis> SingleAction </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../FileNames/ class=md-nav__link> <span class=md-ellipsis> FileNames </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_14 type=checkbox id=__nav_2_14> <label class=md-nav__link for=__nav_2_14> <span class=md-ellipsis> Spark SQL Extensions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Spark SQL Extensions" data-md-level=2> <label class=md-nav__title for=__nav_2_14> <span class="md-nav__icon md-icon"></span> Spark SQL Extensions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../AppendDelta/ class=md-nav__link> <span class=md-ellipsis> AppendDelta </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaAnalysis/ class=md-nav__link> <span class=md-ellipsis> DeltaAnalysis </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaCatalog/ class=md-nav__link> <span class=md-ellipsis> DeltaCatalog </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaSparkSessionExtension/ class=md-nav__link> <span class=md-ellipsis> DeltaSparkSessionExtension </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaTableV2/ class=md-nav__link> <span class=md-ellipsis> DeltaTableV2 </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaUnsupportedOperationsCheck/ class=md-nav__link> <span class=md-ellipsis> DeltaUnsupportedOperationsCheck </span> </a> </li> <li class=md-nav__item> <a href=../../../PreprocessTableDelete/ class=md-nav__link> <span class=md-ellipsis> PreprocessTableDelete </span> </a> </li> <li class=md-nav__item> <a href=../../../PreprocessTableMerge/ class=md-nav__link> <span class=md-ellipsis> PreprocessTableMerge </span> </a> </li> <li class=md-nav__item> <a href=../../../PreprocessTableRestore/ class=md-nav__link> <span class=md-ellipsis> PreprocessTableRestore </span> </a> </li> <li class=md-nav__item> <a href=../../../PreprocessTableUpdate/ class=md-nav__link> <span class=md-ellipsis> PreprocessTableUpdate </span> </a> </li> <li class=md-nav__item> <a href=../../../StagedDeltaTableV2/ class=md-nav__link> <span class=md-ellipsis> StagedDeltaTableV2 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_15 type=checkbox id=__nav_2_15> <label class=md-nav__link for=__nav_2_15> <span class=md-ellipsis> File Indices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="File Indices" data-md-level=2> <label class=md-nav__title for=__nav_2_15> <span class="md-nav__icon md-icon"></span> File Indices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../TahoeFileIndex/ class=md-nav__link> <span class=md-ellipsis> TahoeFileIndex </span> </a> </li> <li class=md-nav__item> <a href=../../../PinnedTahoeFileIndex/ class=md-nav__link> <span class=md-ellipsis> PinnedTahoeFileIndex </span> </a> </li> <li class=md-nav__item> <a href=../../../TahoeBatchFileIndex/ class=md-nav__link> <span class=md-ellipsis> TahoeBatchFileIndex </span> </a> </li> <li class=md-nav__item> <a href=../../../TahoeLogFileIndex/ class=md-nav__link> <span class=md-ellipsis> TahoeLogFileIndex </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaLogFileIndex/ class=md-nav__link> <span class=md-ellipsis> DeltaLogFileIndex </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../../features/ class="md-nav__link "> <span class=md-ellipsis> Features </span> </a> <label class="md-nav__link " for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Features data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <div class="md-nav__link md-nav__container"> <a href=../../../change-data-feed/ class="md-nav__link "> <span class=md-ellipsis> Change Data Feed </span> </a> <label class="md-nav__link " for=__nav_3_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Change Data Feed" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Change Data Feed </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../change-data-feed/CdcAddFileIndex/ class=md-nav__link> <span class=md-ellipsis> CdcAddFileIndex </span> </a> </li> <li class=md-nav__item> <a href=../../../change-data-feed/CDCReader/ class=md-nav__link> <span class=md-ellipsis> CDCReader </span> </a> </li> <li class=md-nav__item> <a href=../../../change-data-feed/DeltaSourceCDCSupport/ class=md-nav__link> <span class=md-ellipsis> DeltaSourceCDCSupport </span> </a> </li> <li class=md-nav__item> <a href=../../../change-data-feed/IndexedChangeFileSeq/ class=md-nav__link> <span class=md-ellipsis> IndexedChangeFileSeq </span> </a> </li> <li class=md-nav__item> <a href=../../../change-data-feed/TahoeRemoveFileIndex/ class=md-nav__link> <span class=md-ellipsis> TahoeRemoveFileIndex </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <div class="md-nav__link md-nav__container"> <a href=../../../check-constraints/ class="md-nav__link "> <span class=md-ellipsis> CHECK Constraints </span> </a> <label class="md-nav__link " for=__nav_3_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="CHECK Constraints" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> CHECK Constraints </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../check-constraints/AddConstraint/ class=md-nav__link> <span class=md-ellipsis> AddConstraint </span> </a> </li> <li class=md-nav__item> <a href=../../../check-constraints/AlterTableAddConstraint/ class=md-nav__link> <span class=md-ellipsis> AlterTableAddConstraint </span> </a> </li> <li class=md-nav__item> <a href=../../../check-constraints/AlterTableDropConstraint/ class=md-nav__link> <span class=md-ellipsis> AlterTableDropConstraint </span> </a> </li> <li class=md-nav__item> <a href=../../../check-constraints/DropConstraint/ class=md-nav__link> <span class=md-ellipsis> DropConstraint </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <div class="md-nav__link md-nav__container"> <a href=../../../column-mapping/ class="md-nav__link "> <span class=md-ellipsis> Column Mapping </span> </a> <label class="md-nav__link " for=__nav_3_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Column Mapping" data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Column Mapping </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../column-mapping/DeltaColumnMappingBase/ class=md-nav__link> <span class=md-ellipsis> DeltaColumnMappingBase </span> </a> </li> <li class=md-nav__item> <a href=../../../column-mapping/DeltaColumnMappingMode/ class=md-nav__link> <span class=md-ellipsis> DeltaColumnMappingMode </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <div class="md-nav__link md-nav__container"> <a href=../../../data-skipping/ class="md-nav__link "> <span class=md-ellipsis> Data Skipping </span> </a> <label class="md-nav__link " for=__nav_3_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Data Skipping" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Data Skipping </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data-skipping/DataSkippingReaderBase/ class=md-nav__link> <span class=md-ellipsis> DataSkippingReaderBase </span> </a> </li> <li class=md-nav__item> <a href=../../../data-skipping/DeltaScan/ class=md-nav__link> <span class=md-ellipsis> DeltaScan </span> </a> </li> <li class=md-nav__item> <a href=../../../data-skipping/PreparedDeltaFileIndex/ class=md-nav__link> <span class=md-ellipsis> PreparedDeltaFileIndex </span> </a> </li> <li class=md-nav__item> <a href=../../../data-skipping/PrepareDeltaScan/ class=md-nav__link> <span class=md-ellipsis> PrepareDeltaScan </span> </a> </li> <li class=md-nav__item> <a href=../../../data-skipping/PrepareDeltaScanBase/ class=md-nav__link> <span class=md-ellipsis> PrepareDeltaScanBase </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6> <div class="md-nav__link md-nav__container"> <a href=../../../generated-columns/ class="md-nav__link "> <span class=md-ellipsis> Generated Columns </span> </a> <label class="md-nav__link " for=__nav_3_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Generated Columns" data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Generated Columns </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../generated-columns/GeneratedColumn/ class=md-nav__link> <span class=md-ellipsis> GeneratedColumn </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 type=checkbox id=__nav_3_7> <div class="md-nav__link md-nav__container"> <a href=../../../constraints/ class="md-nav__link "> <span class=md-ellipsis> Table Constraints </span> </a> <label class="md-nav__link " for=__nav_3_7> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Table Constraints" data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Table Constraints </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../constraints/CheckDeltaInvariant/ class=md-nav__link> <span class=md-ellipsis> CheckDeltaInvariant </span> </a> </li> <li class=md-nav__item> <a href=../../../constraints/Constraint/ class=md-nav__link> <span class=md-ellipsis> Constraint </span> </a> </li> <li class=md-nav__item> <a href=../../../constraints/Constraints/ class=md-nav__link> <span class=md-ellipsis> Constraints </span> </a> </li> <li class=md-nav__item> <a href=../../../constraints/DeltaInvariantChecker/ class=md-nav__link> <span class=md-ellipsis> DeltaInvariantChecker </span> </a> </li> <li class=md-nav__item> <a href=../../../constraints/DeltaInvariantCheckerExec/ class=md-nav__link> <span class=md-ellipsis> DeltaInvariantCheckerExec </span> </a> </li> <li class=md-nav__item> <a href=../../../constraints/DeltaInvariantCheckerStrategy/ class=md-nav__link> <span class=md-ellipsis> DeltaInvariantCheckerStrategy </span> </a> </li> <li class=md-nav__item> <a href=../../../constraints/Invariant/ class=md-nav__link> <span class=md-ellipsis> Invariant </span> </a> </li> <li class=md-nav__item> <a href=../../../constraints/Invariants/ class=md-nav__link> <span class=md-ellipsis> Invariants </span> </a> </li> <li class=md-nav__item> <a href=../../../constraints/InvariantViolationException/ class=md-nav__link> <span class=md-ellipsis> InvariantViolationException </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8 type=checkbox id=__nav_3_8> <div class="md-nav__link md-nav__container"> <a href=../../../time-travel/ class="md-nav__link "> <span class=md-ellipsis> Time Travel </span> </a> <label class="md-nav__link " for=__nav_3_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Time Travel" data-md-level=2> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Time Travel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../time-travel/DeltaTimeTravelSpec/ class=md-nav__link> <span class=md-ellipsis> DeltaTimeTravelSpec </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> <span class=md-ellipsis> Delta Data Source </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Delta Data Source" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Delta Data Source </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../DeltaDataSource/ class=md-nav__link> <span class=md-ellipsis> DeltaDataSource </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> <span class=md-ellipsis> Options </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Options data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Options </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../options/ class=md-nav__link> <span class=md-ellipsis> Options </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaOptions/ class=md-nav__link> <span class=md-ellipsis> DeltaOptions </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaOptionParser/ class=md-nav__link> <span class=md-ellipsis> DeltaOptionParser </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaReadOptions/ class=md-nav__link> <span class=md-ellipsis> DeltaReadOptions </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaWriteOptions/ class=md-nav__link> <span class=md-ellipsis> DeltaWriteOptions </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaWriteOptionsImpl/ class=md-nav__link> <span class=md-ellipsis> DeltaWriteOptionsImpl </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> <span class=md-ellipsis> DeltaSource </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=DeltaSource data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> DeltaSource </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../AdmissionLimits/ class=md-nav__link> <span class=md-ellipsis> AdmissionLimits </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaSource/ class=md-nav__link> <span class=md-ellipsis> DeltaSource </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaSourceBase/ class=md-nav__link> <span class=md-ellipsis> DeltaSourceBase </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaSourceOffset/ class=md-nav__link> <span class=md-ellipsis> DeltaSourceOffset </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaSourceSnapshot/ class=md-nav__link> <span class=md-ellipsis> DeltaSourceSnapshot </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaSourceUtils/ class=md-nav__link> <span class=md-ellipsis> DeltaSourceUtils </span> </a> </li> <li class=md-nav__item> <a href=../../../SnapshotIterator/ class=md-nav__link> <span class=md-ellipsis> SnapshotIterator </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../DeltaSink/ class=md-nav__link> <span class=md-ellipsis> DeltaSink </span> </a> </li> <li class=md-nav__item> <a href=../../../WriteIntoDeltaBuilder/ class=md-nav__link> <span class=md-ellipsis> WriteIntoDeltaBuilder </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> <span class=md-ellipsis> Developer API </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Developer API" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Developer API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../DeltaTable/ class=md-nav__link> <span class=md-ellipsis> DeltaTable </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaTableBuilder/ class=md-nav__link> <span class=md-ellipsis> DeltaTableBuilder </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaColumnBuilder/ class=md-nav__link> <span class=md-ellipsis> DeltaColumnBuilder </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaOptimizeBuilder/ class=md-nav__link> <span class=md-ellipsis> DeltaOptimizeBuilder </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_5 type=checkbox id=__nav_5_5> <div class="md-nav__link md-nav__container"> <a href=../../../exceptions/ class="md-nav__link "> <span class=md-ellipsis> Exceptions </span> </a> <label class="md-nav__link " for=__nav_5_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Exceptions data-md-level=2> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Exceptions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../exceptions/ConcurrentAppendException/ class=md-nav__link> <span class=md-ellipsis> ConcurrentAppendException </span> </a> </li> <li class=md-nav__item> <a href=../../../exceptions/ConcurrentDeleteDeleteException/ class=md-nav__link> <span class=md-ellipsis> ConcurrentDeleteDeleteException </span> </a> </li> <li class=md-nav__item> <a href=../../../exceptions/ConcurrentDeleteReadException/ class=md-nav__link> <span class=md-ellipsis> ConcurrentDeleteReadException </span> </a> </li> <li class=md-nav__item> <a href=../../../exceptions/ConcurrentTransactionException/ class=md-nav__link> <span class=md-ellipsis> ConcurrentTransactionException </span> </a> </li> <li class=md-nav__item> <a href=../../../exceptions/ConcurrentWriteException/ class=md-nav__link> <span class=md-ellipsis> ConcurrentWriteException </span> </a> </li> <li class=md-nav__item> <a href=../../../exceptions/DeltaConcurrentModificationException/ class=md-nav__link> <span class=md-ellipsis> DeltaConcurrentModificationException </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaErrors/ class=md-nav__link> <span class=md-ellipsis> DeltaErrors </span> </a> </li> <li class=md-nav__item> <a href=../../../exceptions/MetadataChangedException/ class=md-nav__link> <span class=md-ellipsis> MetadataChangedException </span> </a> </li> <li class=md-nav__item> <a href=../../../exceptions/ProtocolChangedException/ class=md-nav__link> <span class=md-ellipsis> ProtocolChangedException </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../LogStore/ class=md-nav__link> <span class=md-ellipsis> LogStore </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../../../sql/ class="md-nav__link "> <span class=md-ellipsis> Delta SQL </span> </a> <label class="md-nav__link " for=__nav_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Delta SQL" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Delta SQL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../sql/DeltaSqlParser/ class=md-nav__link> <span class=md-ellipsis> DeltaSqlParser </span> </a> </li> <li class=md-nav__item> <a href=../../../sql/DeltaSqlAstBuilder/ class=md-nav__link> <span class=md-ellipsis> DeltaSqlAstBuilder </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> Commands </span> </a> <label class="md-nav__link " for=__nav_7> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Commands data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Commands </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../DeltaCommand/ class=md-nav__link> <span class=md-ellipsis> DeltaCommand </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_3 type=checkbox id=__nav_7_3> <div class="md-nav__link md-nav__container"> <a href=../../alter/ class="md-nav__link "> <span class=md-ellipsis> ALTER TABLE </span> </a> <label class="md-nav__link " for=__nav_7_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="ALTER TABLE" data-md-level=2> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> ALTER TABLE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../alter/AlterDeltaTableCommand/ class=md-nav__link> <span class=md-ellipsis> AlterDeltaTableCommand </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableAddColumnsDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> ADD COLUMNS </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableAddConstraintDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> ADD CONSTRAINT </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableChangeColumnDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> CHANGE COLUMN </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableDropColumnsDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> AlterTableDropColumnsDeltaCommand </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableDropConstraintDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> DROP CONSTRAINT </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableReplaceColumnsDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> AlterTableReplaceColumnsDeltaCommand </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableSetLocationDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> AlterTableSetLocationDeltaCommand </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableSetPropertiesDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> SET TBLPROPERTIES </span> </a> </li> <li class=md-nav__item> <a href=../../alter/AlterTableUnsetPropertiesDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> AlterTableUnsetPropertiesDeltaCommand </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4 type=checkbox id=__nav_7_4> <div class="md-nav__link md-nav__container"> <a href=../../convert/ class="md-nav__link "> <span class=md-ellipsis> Convert to Delta </span> </a> <label class="md-nav__link " for=__nav_7_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Convert to Delta" data-md-level=2> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Convert to Delta </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../convert/ConvertTargetTable/ class=md-nav__link> <span class=md-ellipsis> ConvertTargetTable </span> </a> </li> <li class=md-nav__item> <a href=../../convert/ConvertToDeltaCommand/ class=md-nav__link> <span class=md-ellipsis> ConvertToDeltaCommand </span> </a> </li> <li class=md-nav__item> <a href=../../convert/DeltaConvert/ class=md-nav__link> <span class=md-ellipsis> DeltaConvert </span> </a> </li> <li class=md-nav__item> <a href=../../convert/FileManifest/ class=md-nav__link> <span class=md-ellipsis> FileManifest </span> </a> </li> <li class=md-nav__item> <a href=../../convert/ManualListingFileManifest/ class=md-nav__link> <span class=md-ellipsis> ManualListingFileManifest </span> </a> </li> <li class=md-nav__item> <a href=../../convert/MetadataLogFileManifest/ class=md-nav__link> <span class=md-ellipsis> MetadataLogFileManifest </span> </a> </li> <li class=md-nav__item> <a href=../../convert/ParquetTable/ class=md-nav__link> <span class=md-ellipsis> ParquetTable </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../CreateDeltaTableCommand/ class=md-nav__link> <span class=md-ellipsis> CreateDeltaTableCommand </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_6 type=checkbox id=__nav_7_6> <div class="md-nav__link md-nav__container"> <a href=../../delete/ class="md-nav__link "> <span class=md-ellipsis> Delete </span> </a> <label class="md-nav__link " for=__nav_7_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Delete data-md-level=2> <label class=md-nav__title for=__nav_7_6> <span class="md-nav__icon md-icon"></span> Delete </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../delete/DeleteCommand/ class=md-nav__link> <span class=md-ellipsis> DeleteCommand </span> </a> </li> <li class=md-nav__item> <a href=../../delete/DeltaDelete/ class=md-nav__link> <span class=md-ellipsis> DeltaDelete </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_7 type=checkbox id=__nav_7_7> <div class="md-nav__link md-nav__container"> <a href=../../describe-detail/ class="md-nav__link "> <span class=md-ellipsis> Describe Detail </span> </a> <label class="md-nav__link " for=__nav_7_7> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Describe Detail" data-md-level=2> <label class=md-nav__title for=__nav_7_7> <span class="md-nav__icon md-icon"></span> Describe Detail </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../describe-detail/DescribeDeltaDetailCommand/ class=md-nav__link> <span class=md-ellipsis> DescribeDeltaDetailCommand </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_8 type=checkbox id=__nav_7_8> <div class="md-nav__link md-nav__container"> <a href=../../describe-history/ class="md-nav__link "> <span class=md-ellipsis> Describe History </span> </a> <label class="md-nav__link " for=__nav_7_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Describe History" data-md-level=2> <label class=md-nav__title for=__nav_7_8> <span class="md-nav__icon md-icon"></span> Describe History </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../describe-history/DescribeDeltaHistoryCommand/ class=md-nav__link> <span class=md-ellipsis> DescribeDeltaHistoryCommand </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_9 type=checkbox id=__nav_7_9> <div class="md-nav__link md-nav__container"> <a href=../../generate/ class="md-nav__link "> <span class=md-ellipsis> Generate </span> </a> <label class="md-nav__link " for=__nav_7_9> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Generate data-md-level=2> <label class=md-nav__title for=__nav_7_9> <span class="md-nav__icon md-icon"></span> Generate </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../generate/DeltaGenerateCommand/ class=md-nav__link> <span class=md-ellipsis> DeltaGenerateCommand </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_10 type=checkbox id=__nav_7_10 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> Merge </span> </a> <label class="md-nav__link " for=__nav_7_10> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Merge data-md-level=2> <label class=md-nav__title for=__nav_7_10> <span class="md-nav__icon md-icon"></span> Merge </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../DeltaMergeAction/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeAction </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeBuilder/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeBuilder </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeInto/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeInto </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeIntoClause/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeIntoClause </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeIntoDeleteClause/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeIntoDeleteClause </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeIntoInsertClause/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeIntoInsertClause </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeIntoMatchedClause/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeIntoMatchedClause </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeIntoUpdateClause/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeIntoUpdateClause </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeMatchedActionBuilder/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeMatchedActionBuilder </span> </a> </li> <li class=md-nav__item> <a href=../DeltaMergeNotMatchedActionBuilder/ class=md-nav__link> <span class=md-ellipsis> DeltaMergeNotMatchedActionBuilder </span> </a> </li> <li class=md-nav__item> <a href=../JoinedRowProcessor/ class=md-nav__link> <span class=md-ellipsis> JoinedRowProcessor </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> MergeIntoCommand </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> MergeIntoCommand </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#performance-metrics class=md-nav__link> <span class=md-ellipsis> Performance Metrics </span> </a> <nav class=md-nav aria-label="Performance Metrics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#number-of-target-rows-rewritten-unmodified class=md-nav__link> <span class=md-ellipsis> number of target rows rewritten unmodified </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creating-instance class=md-nav__link> <span class=md-ellipsis> Creating Instance </span> </a> <nav class=md-nav aria-label="Creating Instance"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#source-data class=md-nav__link> <span class=md-ellipsis> Source Data </span> </a> </li> <li class=md-nav__item> <a href=#migrated-schema class=md-nav__link> <span class=md-ellipsis> Migrated Schema </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#target-delta-table class=md-nav__link> <span class=md-ellipsis> Target Delta Table </span> </a> </li> <li class=md-nav__item> <a href=#executing-command class=md-nav__link> <span class=md-ellipsis> Executing Command </span> </a> <nav class=md-nav aria-label=" Executing Command"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#begin-transaction class=md-nav__link> <span class=md-ellipsis> Begin Transaction </span> </a> </li> <li class=md-nav__item> <a href=#schemaautomergeenabled class=md-nav__link> <span class=md-ellipsis> schema.autoMerge.enabled </span> </a> </li> <li class=md-nav__item> <a href=#fileactions class=md-nav__link> <span class=md-ellipsis> FileActions </span> </a> <nav class=md-nav aria-label=" FileActions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#single-insert-only-merge class=md-nav__link> <span class=md-ellipsis> Single Insert-Only Merge </span> </a> </li> <li class=md-nav__item> <a href=#other-merges class=md-nav__link> <span class=md-ellipsis> Other Merges </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#register-metrics class=md-nav__link> <span class=md-ellipsis> Register Metrics </span> </a> </li> <li class=md-nav__item> <a href=#commit-transaction class=md-nav__link> <span class=md-ellipsis> Commit Transaction </span> </a> </li> <li class=md-nav__item> <a href=#re-cache-target-delta-table class=md-nav__link> <span class=md-ellipsis> Re-Cache Target Delta Table </span> </a> </li> <li class=md-nav__item> <a href=#post-metric-updates class=md-nav__link> <span class=md-ellipsis> Post Metric Updates </span> </a> </li> <li class=md-nav__item> <a href=#building-target-logical-query-plan-for-addfiles class=md-nav__link> <span class=md-ellipsis> Building Target Logical Query Plan for AddFiles </span> </a> </li> <li class=md-nav__item> <a href=#exceptions class=md-nav__link> <span class=md-ellipsis> Exceptions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#writing-out-single-insert-only-merge class=md-nav__link> <span class=md-ellipsis> Writing Out Single Insert-Only Merge </span> </a> <nav class=md-nav aria-label=" Writing Out Single Insert-Only Merge"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#target-output-columns class=md-nav__link> <span class=md-ellipsis> Target Output Columns </span> </a> </li> <li class=md-nav__item> <a href=#source-dataframe class=md-nav__link> <span class=md-ellipsis> Source DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#data-skipped-addfiles class=md-nav__link> <span class=md-ellipsis> Data-Skipped AddFiles </span> </a> </li> <li class=md-nav__item> <a href=#target-dataframe class=md-nav__link> <span class=md-ellipsis> Target DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#insert-dataframe class=md-nav__link> <span class=md-ellipsis> Insert DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#writefiles class=md-nav__link> <span class=md-ellipsis> writeFiles </span> </a> </li> <li class=md-nav__item> <a href=#update-metrics class=md-nav__link> <span class=md-ellipsis> Update Metrics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#writing-out-merged-data class=md-nav__link> <span class=md-ellipsis> Writing Out Merged Data </span> </a> <nav class=md-nav aria-label=" Writing Out Merged Data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#targetoutputcols class=md-nav__link> <span class=md-ellipsis> targetOutputCols </span> </a> </li> <li class=md-nav__item> <a href=#newtarget-query-plan class=md-nav__link> <span class=md-ellipsis> newTarget Query Plan </span> </a> </li> <li class=md-nav__item> <a href=#join-type class=md-nav__link> <span class=md-ellipsis> Join Type </span> </a> </li> <li class=md-nav__item> <a href=#source-dataframe_1 class=md-nav__link> <span class=md-ellipsis> Source DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#new-target-dataframe class=md-nav__link> <span class=md-ellipsis> New Target DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#joined-dataframe class=md-nav__link> <span class=md-ellipsis> Joined DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#output-schema class=md-nav__link> <span class=md-ellipsis> Output Schema </span> </a> </li> <li class=md-nav__item> <a href=#create-joinedrowprocessor class=md-nav__link> <span class=md-ellipsis> Create JoinedRowProcessor </span> </a> </li> <li class=md-nav__item> <a href=#output-dataframe class=md-nav__link> <span class=md-ellipsis> Output DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#writefiles_1 class=md-nav__link> <span class=md-ellipsis> writeFiles </span> </a> </li> <li class=md-nav__item> <a href=#update-metrics_1 class=md-nav__link> <span class=md-ellipsis> Update Metrics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#single-insert-only-merge_1 class=md-nav__link> <span class=md-ellipsis> Single Insert-Only Merge </span> </a> </li> <li class=md-nav__item> <a href=#matched-only-merge class=md-nav__link> <span class=md-ellipsis> Matched-Only Merge </span> </a> </li> <li class=md-nav__item> <a href=#creating-metric-update-udf class=md-nav__link> <span class=md-ellipsis> Creating Metric Update UDF </span> </a> </li> <li class=md-nav__item> <a href=#notmatchedclauseoutput class=md-nav__link> <span class=md-ellipsis> notMatchedClauseOutput </span> </a> </li> <li class=md-nav__item> <a href=#finding-files-to-rewrite class=md-nav__link> <span class=md-ellipsis> Finding Files to Rewrite </span> </a> <nav class=md-nav aria-label=" Finding Files to Rewrite"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#recordtouchedfilename class=md-nav__link> <span class=md-ellipsis> recordTouchedFileName </span> </a> </li> <li class=md-nav__item> <a href=#dataskippedfiles class=md-nav__link> <span class=md-ellipsis> dataSkippedFiles </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#repartitionifneeded class=md-nav__link> <span class=md-ellipsis> repartitionIfNeeded </span> </a> </li> <li class=md-nav__item> <a href=#leafrunnablecommand class=md-nav__link> <span class=md-ellipsis> LeafRunnableCommand </span> </a> </li> <li class=md-nav__item> <a href=#demo class=md-nav__link> <span class=md-ellipsis> Demo </span> </a> </li> <li class=md-nav__item> <a href=#logging class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_11 type=checkbox id=__nav_7_11> <div class="md-nav__link md-nav__container"> <a href=../../optimize/ class="md-nav__link "> <span class=md-ellipsis> Optimize </span> </a> <label class="md-nav__link " for=__nav_7_11> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Optimize data-md-level=2> <label class=md-nav__title for=__nav_7_11> <span class="md-nav__icon md-icon"></span> Optimize </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../optimize/InterleaveBits/ class=md-nav__link> <span class=md-ellipsis> InterleaveBits </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/MultiDimClustering/ class=md-nav__link> <span class=md-ellipsis> MultiDimClustering </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/MultiDimClusteringFunctions/ class=md-nav__link> <span class=md-ellipsis> MultiDimClusteringFunctions </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/OptimizeExecutor/ class=md-nav__link> <span class=md-ellipsis> OptimizeExecutor </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/OptimizeMetrics/ class=md-nav__link> <span class=md-ellipsis> OptimizeMetrics </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/OptimizeStats/ class=md-nav__link> <span class=md-ellipsis> OptimizeStats </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/OptimizeTableCommand/ class=md-nav__link> <span class=md-ellipsis> OptimizeTableCommand </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/OptimizeTableCommandBase/ class=md-nav__link> <span class=md-ellipsis> OptimizeTableCommandBase </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/RangePartitionId/ class=md-nav__link> <span class=md-ellipsis> RangePartitionId </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/RangePartitionIdRewrite/ class=md-nav__link> <span class=md-ellipsis> RangePartitionIdRewrite </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/PartitionerExpr/ class=md-nav__link> <span class=md-ellipsis> PartitionerExpr </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/SpaceFillingCurveClustering/ class=md-nav__link> <span class=md-ellipsis> SpaceFillingCurveClustering </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/ZOrderClustering/ class=md-nav__link> <span class=md-ellipsis> ZOrderClustering </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_12 type=checkbox id=__nav_7_12> <div class="md-nav__link md-nav__container"> <a href=../../restore/ class="md-nav__link "> <span class=md-ellipsis> Restore </span> </a> <label class="md-nav__link " for=__nav_7_12> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Restore data-md-level=2> <label class=md-nav__title for=__nav_7_12> <span class="md-nav__icon md-icon"></span> Restore </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../restore/RestoreTableCommand/ class=md-nav__link> <span class=md-ellipsis> RestoreTableCommand </span> </a> </li> <li class=md-nav__item> <a href=../../restore/RestoreTableCommandBase/ class=md-nav__link> <span class=md-ellipsis> RestoreTableCommandBase </span> </a> </li> <li class=md-nav__item> <a href=../../restore/RestoreTableStatement/ class=md-nav__link> <span class=md-ellipsis> RestoreTableStatement </span> </a> </li> <li class=md-nav__item> <a href=../../restore/TimeTravel/ class=md-nav__link> <span class=md-ellipsis> TimeTravel </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_13 type=checkbox id=__nav_7_13> <div class="md-nav__link md-nav__container"> <a href=../../update/ class="md-nav__link "> <span class=md-ellipsis> Update </span> </a> <label class="md-nav__link " for=__nav_7_13> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Update data-md-level=2> <label class=md-nav__title for=__nav_7_13> <span class="md-nav__icon md-icon"></span> Update </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../update/UpdateCommand/ class=md-nav__link> <span class=md-ellipsis> UpdateCommand </span> </a> </li> <li class=md-nav__item> <a href=../../update/DeltaUpdateTable/ class=md-nav__link> <span class=md-ellipsis> DeltaUpdateTable </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_14 type=checkbox id=__nav_7_14> <div class="md-nav__link md-nav__container"> <a href=../../vacuum/ class="md-nav__link "> <span class=md-ellipsis> Vacuum </span> </a> <label class="md-nav__link " for=__nav_7_14> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Vacuum data-md-level=2> <label class=md-nav__title for=__nav_7_14> <span class="md-nav__icon md-icon"></span> Vacuum </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../vacuum/VacuumCommand/ class=md-nav__link> <span class=md-ellipsis> VacuumCommand </span> </a> </li> <li class=md-nav__item> <a href=../../vacuum/VacuumCommandImpl/ class=md-nav__link> <span class=md-ellipsis> VacuumCommandImpl </span> </a> </li> <li class=md-nav__item> <a href=../../vacuum/VacuumTableCommand/ class=md-nav__link> <span class=md-ellipsis> VacuumTableCommand </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../WriteIntoDelta/ class=md-nav__link> <span class=md-ellipsis> WriteIntoDelta </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <div class="md-nav__link md-nav__container"> <a href=../../../demo/ class="md-nav__link "> <span class=md-ellipsis> Demos </span> </a> <label class="md-nav__link " for=__nav_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Demos data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../demo/change-data-feed/ class=md-nav__link> <span class=md-ellipsis> Change Data Feed </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/generated-columns/ class=md-nav__link> <span class=md-ellipsis> Generated Columns </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/column-mapping/ class=md-nav__link> <span class=md-ellipsis> Column Mapping </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/rolling-back-table-changes-restore-command/ class=md-nav__link> <span class=md-ellipsis> Rolling Back Table Changes (Restore Command) </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/optimize/ class=md-nav__link> <span class=md-ellipsis> Optimize </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/data-skipping/ class=md-nav__link> <span class=md-ellipsis> Data Skipping </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/time-travel/ class=md-nav__link> <span class=md-ellipsis> Time Travel </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/vacuum/ class=md-nav__link> <span class=md-ellipsis> Vacuum </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/dataChange/ class=md-nav__link> <span class=md-ellipsis> dataChange </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/replaceWhere/ class=md-nav__link> <span class=md-ellipsis> replaceWhere </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/merge-operation/ class=md-nav__link> <span class=md-ellipsis> Merge Operation </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/Converting-Parquet-Dataset-Into-Delta-Format/ class=md-nav__link> <span class=md-ellipsis> Converting Parquet Dataset Into Delta Format </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/stream-processing-of-delta-table/ class=md-nav__link> <span class=md-ellipsis> Stream Processing of Delta Table </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/Using-Delta-Lake-as-Streaming-Sink-in-Structured-Streaming/ class=md-nav__link> <span class=md-ellipsis> Using Delta Lake as Streaming Sink in Structured Streaming </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/Debugging-Delta-Lake-Using-IntelliJ-IDEA/ class=md-nav__link> <span class=md-ellipsis> Debugging Delta Lake Using IntelliJ IDEA </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/Observing-Transaction-Retries/ class=md-nav__link> <span class=md-ellipsis> Observing Transaction Retries </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/DeltaTable-DeltaLog-And-Snapshots/ class=md-nav__link> <span class=md-ellipsis> DeltaTable, DeltaLog And Snapshots </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/schema-evolution/ class=md-nav__link> <span class=md-ellipsis> Schema Evolution </span> </a> </li> <li class=md-nav__item> <a href=../../../demo/user-metadata-for-labelling-commits/ class=md-nav__link> <span class=md-ellipsis> User Metadata for Labelling Commits </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> <span class=md-ellipsis> Misc </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Misc data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ColumnWithDefaultExprUtils/ class=md-nav__link> <span class=md-ellipsis> ColumnWithDefaultExprUtils </span> </a> </li> <li class=md-nav__item> <a href=../../../ConflictChecker/ class=md-nav__link> <span class=md-ellipsis> ConflictChecker </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaFileOperations/ class=md-nav__link> <span class=md-ellipsis> DeltaFileOperations </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaJobStatisticsTracker/ class=md-nav__link> <span class=md-ellipsis> DeltaJobStatisticsTracker </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaRelation/ class=md-nav__link> <span class=md-ellipsis> DeltaRelation </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaScanGenerator/ class=md-nav__link> <span class=md-ellipsis> DeltaScanGenerator </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaScanGeneratorBase/ class=md-nav__link> <span class=md-ellipsis> DeltaScanGeneratorBase </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaTableOperations/ class=md-nav__link> <span class=md-ellipsis> DeltaTableOperations </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaTableUtils/ class=md-nav__link> <span class=md-ellipsis> DeltaTableUtils </span> </a> </li> <li class=md-nav__item> <a href=../../../ImplicitMetadataOperation/ class=md-nav__link> <span class=md-ellipsis> ImplicitMetadataOperation </span> </a> </li> <li class=md-nav__item> <a href=../../../SchemaMergingUtils/ class=md-nav__link> <span class=md-ellipsis> SchemaMergingUtils </span> </a> </li> <li class=md-nav__item> <a href=../../../SchemaUtils/ class=md-nav__link> <span class=md-ellipsis> SchemaUtils </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9_13 type=checkbox id=__nav_9_13> <label class=md-nav__link for=__nav_9_13> <span class=md-ellipsis> StateCache </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=StateCache data-md-level=2> <label class=md-nav__title for=__nav_9_13> <span class="md-nav__icon md-icon"></span> StateCache </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../StateCache/ class=md-nav__link> <span class=md-ellipsis> StateCache </span> </a> </li> <li class=md-nav__item> <a href=../../../CachedDS/ class=md-nav__link> <span class=md-ellipsis> CachedDS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../StatisticsCollection/ class=md-nav__link> <span class=md-ellipsis> StatisticsCollection </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10> <span class=md-ellipsis> Monitoring </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Monitoring data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../DeltaProgressReporter/ class=md-nav__link> <span class=md-ellipsis> DeltaProgressReporter </span> </a> </li> <li class=md-nav__item> <a href=../../../DeltaLogging/ class=md-nav__link> <span class=md-ellipsis> DeltaLogging </span> </a> </li> <li class=md-nav__item> <a href=../../../spark-logging/ class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> <li class=md-nav__item> <a href=../../../SQLMetricsReporting/ class=md-nav__link> <span class=md-ellipsis> SQLMetricsReporting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11 type=checkbox id=__nav_11> <div class="md-nav__link md-nav__container"> <a href=../../../contenders/ class="md-nav__link "> <span class=md-ellipsis> Contenders </span> </a> </div> <nav class=md-nav aria-label=Contenders data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Contenders </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#performance-metrics class=md-nav__link> <span class=md-ellipsis> Performance Metrics </span> </a> <nav class=md-nav aria-label="Performance Metrics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#number-of-target-rows-rewritten-unmodified class=md-nav__link> <span class=md-ellipsis> number of target rows rewritten unmodified </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creating-instance class=md-nav__link> <span class=md-ellipsis> Creating Instance </span> </a> <nav class=md-nav aria-label="Creating Instance"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#source-data class=md-nav__link> <span class=md-ellipsis> Source Data </span> </a> </li> <li class=md-nav__item> <a href=#migrated-schema class=md-nav__link> <span class=md-ellipsis> Migrated Schema </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#target-delta-table class=md-nav__link> <span class=md-ellipsis> Target Delta Table </span> </a> </li> <li class=md-nav__item> <a href=#executing-command class=md-nav__link> <span class=md-ellipsis> Executing Command </span> </a> <nav class=md-nav aria-label=" Executing Command"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#begin-transaction class=md-nav__link> <span class=md-ellipsis> Begin Transaction </span> </a> </li> <li class=md-nav__item> <a href=#schemaautomergeenabled class=md-nav__link> <span class=md-ellipsis> schema.autoMerge.enabled </span> </a> </li> <li class=md-nav__item> <a href=#fileactions class=md-nav__link> <span class=md-ellipsis> FileActions </span> </a> <nav class=md-nav aria-label=" FileActions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#single-insert-only-merge class=md-nav__link> <span class=md-ellipsis> Single Insert-Only Merge </span> </a> </li> <li class=md-nav__item> <a href=#other-merges class=md-nav__link> <span class=md-ellipsis> Other Merges </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#register-metrics class=md-nav__link> <span class=md-ellipsis> Register Metrics </span> </a> </li> <li class=md-nav__item> <a href=#commit-transaction class=md-nav__link> <span class=md-ellipsis> Commit Transaction </span> </a> </li> <li class=md-nav__item> <a href=#re-cache-target-delta-table class=md-nav__link> <span class=md-ellipsis> Re-Cache Target Delta Table </span> </a> </li> <li class=md-nav__item> <a href=#post-metric-updates class=md-nav__link> <span class=md-ellipsis> Post Metric Updates </span> </a> </li> <li class=md-nav__item> <a href=#building-target-logical-query-plan-for-addfiles class=md-nav__link> <span class=md-ellipsis> Building Target Logical Query Plan for AddFiles </span> </a> </li> <li class=md-nav__item> <a href=#exceptions class=md-nav__link> <span class=md-ellipsis> Exceptions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#writing-out-single-insert-only-merge class=md-nav__link> <span class=md-ellipsis> Writing Out Single Insert-Only Merge </span> </a> <nav class=md-nav aria-label=" Writing Out Single Insert-Only Merge"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#target-output-columns class=md-nav__link> <span class=md-ellipsis> Target Output Columns </span> </a> </li> <li class=md-nav__item> <a href=#source-dataframe class=md-nav__link> <span class=md-ellipsis> Source DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#data-skipped-addfiles class=md-nav__link> <span class=md-ellipsis> Data-Skipped AddFiles </span> </a> </li> <li class=md-nav__item> <a href=#target-dataframe class=md-nav__link> <span class=md-ellipsis> Target DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#insert-dataframe class=md-nav__link> <span class=md-ellipsis> Insert DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#writefiles class=md-nav__link> <span class=md-ellipsis> writeFiles </span> </a> </li> <li class=md-nav__item> <a href=#update-metrics class=md-nav__link> <span class=md-ellipsis> Update Metrics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#writing-out-merged-data class=md-nav__link> <span class=md-ellipsis> Writing Out Merged Data </span> </a> <nav class=md-nav aria-label=" Writing Out Merged Data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#targetoutputcols class=md-nav__link> <span class=md-ellipsis> targetOutputCols </span> </a> </li> <li class=md-nav__item> <a href=#newtarget-query-plan class=md-nav__link> <span class=md-ellipsis> newTarget Query Plan </span> </a> </li> <li class=md-nav__item> <a href=#join-type class=md-nav__link> <span class=md-ellipsis> Join Type </span> </a> </li> <li class=md-nav__item> <a href=#source-dataframe_1 class=md-nav__link> <span class=md-ellipsis> Source DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#new-target-dataframe class=md-nav__link> <span class=md-ellipsis> New Target DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#joined-dataframe class=md-nav__link> <span class=md-ellipsis> Joined DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#output-schema class=md-nav__link> <span class=md-ellipsis> Output Schema </span> </a> </li> <li class=md-nav__item> <a href=#create-joinedrowprocessor class=md-nav__link> <span class=md-ellipsis> Create JoinedRowProcessor </span> </a> </li> <li class=md-nav__item> <a href=#output-dataframe class=md-nav__link> <span class=md-ellipsis> Output DataFrame </span> </a> </li> <li class=md-nav__item> <a href=#writefiles_1 class=md-nav__link> <span class=md-ellipsis> writeFiles </span> </a> </li> <li class=md-nav__item> <a href=#update-metrics_1 class=md-nav__link> <span class=md-ellipsis> Update Metrics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#single-insert-only-merge_1 class=md-nav__link> <span class=md-ellipsis> Single Insert-Only Merge </span> </a> </li> <li class=md-nav__item> <a href=#matched-only-merge class=md-nav__link> <span class=md-ellipsis> Matched-Only Merge </span> </a> </li> <li class=md-nav__item> <a href=#creating-metric-update-udf class=md-nav__link> <span class=md-ellipsis> Creating Metric Update UDF </span> </a> </li> <li class=md-nav__item> <a href=#notmatchedclauseoutput class=md-nav__link> <span class=md-ellipsis> notMatchedClauseOutput </span> </a> </li> <li class=md-nav__item> <a href=#finding-files-to-rewrite class=md-nav__link> <span class=md-ellipsis> Finding Files to Rewrite </span> </a> <nav class=md-nav aria-label=" Finding Files to Rewrite"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#recordtouchedfilename class=md-nav__link> <span class=md-ellipsis> recordTouchedFileName </span> </a> </li> <li class=md-nav__item> <a href=#dataskippedfiles class=md-nav__link> <span class=md-ellipsis> dataSkippedFiles </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#repartitionifneeded class=md-nav__link> <span class=md-ellipsis> repartitionIfNeeded </span> </a> </li> <li class=md-nav__item> <a href=#leafrunnablecommand class=md-nav__link> <span class=md-ellipsis> LeafRunnableCommand </span> </a> </li> <li class=md-nav__item> <a href=#demo class=md-nav__link> <span class=md-ellipsis> Demo </span> </a> </li> <li class=md-nav__item> <a href=#logging class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/japila-books/delta-lake-internals/edit/main/docs/commands/merge/MergeIntoCommand.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=mergeintocommand>MergeIntoCommand<a class=headerlink href=#mergeintocommand title="Permanent link">&para;</a></h1> <p><code>MergeIntoCommand</code> is a transactional <a href=../../DeltaCommand/ >DeltaCommand</a> that represents a <a href=../DeltaMergeInto/ >DeltaMergeInto</a> logical command at execution.</p> <h2 id=performance-metrics>Performance Metrics<a class=headerlink href=#performance-metrics title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Name</th> <th>web UI</th> </tr> </thead> <tbody> <tr> <td><code>numSourceRows</code></td> <td>number of source rows</td> </tr> <tr> <td><code>numSourceRowsInSecondScan</code></td> <td>number of source rows (during repeated scan)</td> </tr> <tr> <td><code>numTargetFilesAdded</code></td> <td>number of files added to target</td> </tr> <tr> <td><span id=numTargetFilesAfterSkipping> <code>numTargetFilesAfterSkipping</code></td> <td>number of target files after skipping</td> </tr> <tr> <td><span id=numTargetFilesBeforeSkipping> <code>numTargetFilesBeforeSkipping</code></td> <td>number of target files before skipping</td> </tr> <tr> <td><span id=numTargetFilesRemoved> <code>numTargetFilesRemoved</code></td> <td>number of files removed to target</td> </tr> <tr> <td><a href=#numTargetRowsCopied>numTargetRowsCopied</a></td> <td>number of target rows rewritten unmodified</td> </tr> <tr> <td><code>numTargetRowsInserted</code></td> <td>number of inserted rows</td> </tr> <tr> <td><code>numTargetRowsDeleted</code></td> <td>number of deleted rows</td> </tr> <tr> <td><code>numTargetRowsUpdated</code></td> <td>number of updated rows</td> </tr> <tr> <td><em>others</em></td> <td></td> </tr> </tbody> </table> <h3 id=number-of-target-rows-rewritten-unmodified><span id=numTargetRowsCopied> number of target rows rewritten unmodified<a class=headerlink href=#number-of-target-rows-rewritten-unmodified title="Permanent link">&para;</a></h3> <p><code>numTargetRowsCopied</code> performance metric (like the other <a href=#performance-metrics>metrics</a>) is turned into a non-deterministic user-defined function (UDF).</p> <p><code>numTargetRowsCopied</code> becomes <code>incrNoopCountExpr</code> UDF.</p> <p><code>incrNoopCountExpr</code> UDF is resolved on a joined plan and used to create a <a href=../JoinedRowProcessor/#noopCopyOutput>JoinedRowProcessor</a> for <a href=#processPartition>processing partitions</a> of the joined plan <code>Dataset</code>.</p> <h2 id=creating-instance>Creating Instance<a class=headerlink href=#creating-instance title="Permanent link">&para;</a></h2> <p><code>MergeIntoCommand</code> takes the following to be created:</p> <ul> <li><a href=#source>Source Data</a></li> <li><span id=target> Target Data (<a href=https://books.japila.pl/spark-sql-internals/logical-operators/LogicalPlan/ >LogicalPlan</a>)</li> <li><span id=targetFileIndex> <a href=../../../TahoeFileIndex/ >TahoeFileIndex</a></li> <li><span id=condition> Merge Condition (<a href=https://books.japila.pl/spark-sql-internals/expressions/Expression/ >Expression</a>)</li> <li><span id=matchedClauses> <a href=../DeltaMergeIntoMatchedClause/ >Matched Clause</a>s</li> <li><span id=notMatchedClauses> <a href=../DeltaMergeIntoInsertClause/ >Non-Matched Insert Clause</a>s</li> <li><a href=#migratedSchema>Migrated Schema</a></li> </ul> <p><code>MergeIntoCommand</code> is created when:</p> <ul> <li><a href=../../../PreprocessTableMerge/ >PreprocessTableMerge</a> logical resolution rule is executed (to resolve a <a href=../DeltaMergeInto/ >DeltaMergeInto</a> logical command)</li> </ul> <h3 id=source-data><span id=source> Source Data<a class=headerlink href=#source-data title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=n>source</span><span class=p>:</span><span class=w> </span><span class=nc>LogicalPlan</span><span class=w></span>
</code></pre></div> <p>When <a href=#creating-instance>created</a>, <code>MergeIntoCommand</code> is given a <code>LogicalPlan</code> (<a href=https://books.japila.pl/spark-sql-internals/logical-operators/LogicalPlan>Spark SQL</a>) for the source data to merge from (internally referred to as <em>source</em>).</p> <p>The source is used twice:</p> <ul> <li>Firstly, in one of the following:<ul> <li>An inner join (in <a href=#findTouchedFiles>findTouchedFiles</a>) that is <code>count</code> in web UI</li> <li>A leftanti join (in <a href=#writeInsertsOnlyWhenNoMatchedClauses>writeInsertsOnlyWhenNoMatchedClauses</a>)</li> </ul> </li> <li>Secondly, in right or full outer join (in <a href=#writeAllChanges>writeAllChanges</a>)</li> </ul> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Enable <code>DEBUG</code> logging level for <a href=#logging>org.apache.spark.sql.delta.commands.MergeIntoCommand</a> logger to see the inner-workings of <a href=#writeAllChanges>writeAllChanges</a>.</p> </div> <h3 id=migrated-schema><span id=migratedSchema> Migrated Schema<a class=headerlink href=#migrated-schema title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=n>migratedSchema</span><span class=p>:</span><span class=w> </span><span class=nc>Option</span><span class=p>[</span><span class=nc>StructType</span><span class=p>]</span><span class=w></span>
</code></pre></div> <p><code>MergeIntoCommand</code> can be given a <code>migratedSchema</code> (<a href=https://books.japila.pl/spark-sql-internals/types/StructType>Spark SQL</a>).</p> <h2 id=target-delta-table><span id=targetDeltaLog> Target Delta Table<a class=headerlink href=#target-delta-table title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>targetDeltaLog</span><span class=p>:</span><span class=w> </span><span class=nc>DeltaLog</span><span class=w></span>
</code></pre></div> <p><code>targetDeltaLog</code> is the <a href=../../../TahoeFileIndex/#deltaLog>DeltaLog</a> (of the <a href=#targetFileIndex>TahoeFileIndex</a>) of the target delta table.</p> <p><code>targetDeltaLog</code> is used for the following:</p> <ul> <li><a href=../../../DeltaLog/#withNewTransaction>Start a new transaction</a> when <a href=#run>executed</a></li> <li>To access the <a href=../../../DeltaLog/#dataPath>Data Path</a> when <a href=#findTouchedFiles>finding files to rewrite</a></li> </ul> <details class=note> <summary>Lazy Value</summary> <p><code>targetDeltaLog</code> is a Scala <strong>lazy value</strong> to guarantee that the code to initialize it is executed once only (when accessed for the first time) and cached afterwards.</p> </details> <h2 id=executing-command><span id=run> Executing Command<a class=headerlink href=#executing-command title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>run</span><span class=p>(</span><span class=w></span>
<span class=w>  </span><span class=n>spark</span><span class=p>:</span><span class=w> </span><span class=nc>SparkSession</span><span class=p>):</span><span class=w> </span><span class=nc>Seq</span><span class=p>[</span><span class=nc>Row</span><span class=p>]</span><span class=w></span>
</code></pre></div> <p><code>run</code> is part of the <code>RunnableCommand</code> (<a href=https://books.japila.pl/spark-sql-internals/logical-operators/RunnableCommand/ >Spark SQL</a>) abstraction.</p> <hr> <p><code>run</code> is a transactional operation that is made up of the following steps:</p> <ol> <li><a href=#run-withNewTransaction>Begin Transaction</a><ol> <li><a href=#run-canMergeSchema>schema.autoMerge.enabled</a></li> <li><a href=#run-deltaActions>FileActions</a></li> <li><a href=#run-registerSQLMetrics>Register Metrics</a></li> </ol> </li> <li><a href=#run-commit>Commit Transaction</a></li> <li><a href=#run-recacheByPlan>Re-Cache Target Delta Table</a></li> <li><a href=#run-postDriverMetricUpdates>Post Metric Updates</a></li> </ol> <h3 id=begin-transaction><span id=run-withNewTransaction> Begin Transaction<a class=headerlink href=#begin-transaction title="Permanent link">&para;</a></h3> <p><code>run</code> <a href=../../../DeltaLog/#withNewTransaction>starts a new transaction</a> (on the <a href=#targetDeltaLog>target delta table</a>).</p> <h3 id=schemaautomergeenabled><span id=run-canMergeSchema> schema.autoMerge.enabled<a class=headerlink href=#schemaautomergeenabled title="Permanent link">&para;</a></h3> <p>Only when <a href=../../../DeltaSQLConf/#DELTA_SCHEMA_AUTO_MIGRATE>spark.databricks.delta.schema.autoMerge.enabled</a> configuration property is enabled, <code>run</code> <a href=../../../ImplicitMetadataOperation/#updateMetadata>updates the metadata</a> (of the transaction) with the following:</p> <ul> <li><a href=#migratedSchema>migratedSchema</a> (if defined) or the schema of the <a href=#target>target</a></li> <li><code>isOverwriteMode</code> flag off</li> <li><code>rearrangeOnly</code> flag off</li> </ul> <h3 id=fileactions><span id=run-deltaActions> FileActions<a class=headerlink href=#fileactions title="Permanent link">&para;</a></h3> <p><code>run</code> determines <a href=../../../FileAction/ >FileAction</a>s.</p> <h4 id=single-insert-only-merge><span id=run-writeInsertsOnlyWhenNoMatchedClauses> Single Insert-Only Merge<a class=headerlink href=#single-insert-only-merge title="Permanent link">&para;</a></h4> <p>For a <a href=#isSingleInsertOnly>single insert-only merge</a> with <a href=../../../DeltaSQLConf/#MERGE_INSERT_ONLY_ENABLED>spark.databricks.delta.merge.optimizeInsertOnlyMerge.enabled</a> configuration property enabled, <code>run</code> <a href=#writeInsertsOnlyWhenNoMatchedClauses>writeInsertsOnlyWhenNoMatchedClauses</a>.</p> <h4 id=other-merges><span id=run-writeAllChanges> Other Merges<a class=headerlink href=#other-merges title="Permanent link">&para;</a></h4> <p>Otherwise, <code>run</code> <a href=#findTouchedFiles>finds the files to rewrite</a> (i.e., <a href=../../../AddFile/ >AddFile</a>s with the rows that satisfy the merge condition) and uses them to <a href=#writeAllChanges>write out merge changes</a>.</p> <p>The <code>AddFile</code>s are converted into <a href=../../../AddFile/#remove>RemoveFile</a>s.</p> <p><code>run</code> gives the <code>RemoveFile</code>s and the written-out <a href=../../../FileAction/ >FileAction</a>s.</p> <h3 id=register-metrics><span id=run-registerSQLMetrics> Register Metrics<a class=headerlink href=#register-metrics title="Permanent link">&para;</a></h3> <p><code>run</code> <a href=../../../SQLMetricsReporting/#registerSQLMetrics>registers</a> the <a href=#metrics>SQL metrics</a> (with the <a href=../../../OptimisticTransaction/ >current transaction</a>).</p> <h3 id=commit-transaction><span id=run-commit> Commit Transaction<a class=headerlink href=#commit-transaction title="Permanent link">&para;</a></h3> <p><code>run</code> <a href=../../../OptimisticTransactionImpl/#commit>commits</a> the <a href=../../../OptimisticTransaction/ >current transaction</a> (with the <a href=#run-deltaActions>FileActions</a> and <code>MERGE</code> operation).</p> <h3 id=re-cache-target-delta-table><span id=run-recacheByPlan> Re-Cache Target Delta Table<a class=headerlink href=#re-cache-target-delta-table title="Permanent link">&para;</a></h3> <p><code>run</code> requests the <code>CacheManager</code> to re-cache the <a href=#target>target</a> plan.</p> <h3 id=post-metric-updates><span id=run-postDriverMetricUpdates> Post Metric Updates<a class=headerlink href=#post-metric-updates title="Permanent link">&para;</a></h3> <p>In the end, <code>run</code> posts the SQL metric updates (as a <code>SparkListenerDriverAccumUpdates</code> (<a href=https://books.japila.pl/apache-spark-internals/SparkListenerEvent#SparkListenerDriverAccumUpdates>Apache Spark</a>) Spark event) to <code>SparkListener</code>s (incl. Spark UI).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Use <code>SparkListener</code> (<a href=https://books.japila.pl/apache-spark-internals/SparkListener>Apache Spark</a>) to intercept <code>SparkListenerDriverAccumUpdates</code> events.</p> </div> <h3 id=building-target-logical-query-plan-for-addfiles><span id=buildTargetPlanWithFiles> Building Target Logical Query Plan for AddFiles<a class=headerlink href=#building-target-logical-query-plan-for-addfiles title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=n>buildTargetPlanWithFiles</span><span class=p>(</span><span class=w></span>
<span class=w>  </span><span class=n>deltaTxn</span><span class=p>:</span><span class=w> </span><span class=nc>OptimisticTransaction</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=n>files</span><span class=p>:</span><span class=w> </span><span class=nc>Seq</span><span class=p>[</span><span class=nc>AddFile</span><span class=p>]):</span><span class=w> </span><span class=nc>LogicalPlan</span><span class=w></span>
</code></pre></div> <p><code>buildTargetPlanWithFiles</code> creates a DataFrame to represent the given <a href=../../../AddFile/ >AddFile</a>s to access the analyzed logical query plan. <code>buildTargetPlanWithFiles</code> requests the given <a href=../../../OptimisticTransaction/ >OptimisticTransaction</a> for the <a href=../../../OptimisticTransaction/#deltaLog>DeltaLog</a> to <a href=../../../DeltaLog/#createDataFrame>create a DataFrame</a> (for the <a href=../../../OptimisticTransaction/#snapshot>Snapshot</a> and the given <a href=../../../AddFile/ >AddFile</a>s).</p> <p>In the end, <code>buildTargetPlanWithFiles</code> creates a <code>Project</code> logical operator with <code>Alias</code> expressions so the output columns of the analyzed logical query plan (of the <code>DataFrame</code> of the <code>AddFiles</code>) reference the target's output columns (by name).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The output columns of the target delta table are associated with a <a href=../../../OptimisticTransaction/ >OptimisticTransaction</a> as the <a href=../../../OptimisticTransactionImpl/#metadata>Metadata</a>.</p> <div class=highlight><pre><span></span><code><span class=n>deltaTxn</span><span class=p>.</span><span class=n>metadata</span><span class=p>.</span><span class=n>schema</span><span class=w></span>
</code></pre></div> </div> <h3 id=exceptions><span id=run-exceptions> Exceptions<a class=headerlink href=#exceptions title="Permanent link">&para;</a></h3> <p><code>run</code> throws an <code>AnalysisException</code> when the target schema is different than the delta table's (has changed after analysis phase):</p> <div class=highlight><pre><span></span><code>The schema of your Delta table has changed in an incompatible way since your DataFrame or DeltaTable object was created. Please redefine your DataFrame or DeltaTable object. Changes:
[schemaDiff]
This check can be turned off by setting the session configuration key spark.databricks.delta.checkLatestSchemaOnRead to false.
</code></pre></div> <h2 id=writing-out-single-insert-only-merge><span id=writeInsertsOnlyWhenNoMatchedClauses> Writing Out Single Insert-Only Merge<a class=headerlink href=#writing-out-single-insert-only-merge title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>writeInsertsOnlyWhenNoMatchedClauses</span><span class=p>(</span><span class=w></span>
<span class=w>  </span><span class=n>spark</span><span class=p>:</span><span class=w> </span><span class=nc>SparkSession</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=n>deltaTxn</span><span class=p>:</span><span class=w> </span><span class=nc>OptimisticTransaction</span><span class=p>):</span><span class=w> </span><span class=nc>Seq</span><span class=p>[</span><span class=nc>FileAction</span><span class=p>]</span><span class=w></span>
</code></pre></div> <p>In the end, <code>writeInsertsOnlyWhenNoMatchedClauses</code> returns the <a href=../../../FileAction/ >FileAction</a>s (from <a href=../../../TransactionalWrite/#writeFiles>writing out data</a>).</p> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> is used when:</p> <ul> <li><code>MergeIntoCommand</code> is <a href=#run>executed</a> (for <a href=#isSingleInsertOnly>single insert-only merge</a> with <a href=../../../DeltaSQLConf/#MERGE_INSERT_ONLY_ENABLED>spark.databricks.delta.merge.optimizeInsertOnlyMerge.enabled</a> enabled)</li> </ul> <h3 id=target-output-columns><span id=writeInsertsOnlyWhenNoMatchedClauses-outputCols> Target Output Columns<a class=headerlink href=#target-output-columns title="Permanent link">&para;</a></h3> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> gets the names of the output (<em>target</em>) columns.</p> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> creates a collection of output columns with the target names and the <a href=../DeltaMergeIntoClause/#resolvedActions>resolved DeltaMergeActions</a> of a single <a href=#notMatchedClauses>DeltaMergeIntoInsertClause</a> (as <code>Alias</code> expressions).</p> <h3 id=source-dataframe><span id=writeInsertsOnlyWhenNoMatchedClauses-sourceDF> Source DataFrame<a class=headerlink href=#source-dataframe title="Permanent link">&para;</a></h3> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> <a href=#makeMetricUpdateUDF>creates a UDF</a> to update <a href=#numSourceRows>numSourceRows</a> metric.</p> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> creates a source <code>DataFrame</code> for the <a href=#source>source</a> data with <code>Dataset.filter</code>s with the UDF and the <a href=../DeltaMergeIntoInsertClause/#condition>condition</a> of the <a href=../DeltaMergeIntoInsertClause/ >DeltaMergeIntoInsertClause</a> (if defined) or <code>Literal.TrueLiteral</code>.</p> <div class="admonition note"> <p class=admonition-title>Use condition for filter pushdown optimization</p> <p>The <a href=../DeltaMergeIntoInsertClause/#condition>condition</a> of this single <a href=../DeltaMergeIntoInsertClause/ >DeltaMergeIntoInsertClause</a> is pushed down to the <a href=#source>source</a> when Spark SQL optimizes the query.</p> </div> <h3 id=data-skipped-addfiles><span id=writeInsertsOnlyWhenNoMatchedClauses-dataSkippedFiles> Data-Skipped AddFiles<a class=headerlink href=#data-skipped-addfiles title="Permanent link">&para;</a></h3> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> splits conjunctive predicates (<code>And</code> expressions) in the <a href=#condition>merge condition</a> and determines a so-called <em>targetOnlyPredicates</em> (predicates with the <a href=#target>target</a> columns only). <code>writeInsertsOnlyWhenNoMatchedClauses</code> requests the given <a href=../../../OptimisticTransaction/ >OptimisticTransaction</a> to <a href=../../../OptimisticTransactionImpl/#filterFiles>filterFiles</a> matching the target-only predicates (that gives <a href=../../../AddFile/ >AddFile</a>s).</p> <div class="admonition note"> <p class=admonition-title>Merge Condition and Data Skipping</p> <p>The <a href=#condition>merge condition</a> of this <a href=./ >MergeIntoCommand</a> is used for <a href=../../../data-skipping/ >Data Skipping</a>.</p> </div> <h3 id=target-dataframe><span id=writeInsertsOnlyWhenNoMatchedClauses-targetDF> Target DataFrame<a class=headerlink href=#target-dataframe title="Permanent link">&para;</a></h3> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> creates a target <code>DataFrame</code> for the data-skipped <code>AddFile</code>s.</p> <h3 id=insert-dataframe><span id=writeInsertsOnlyWhenNoMatchedClauses-insertDf> Insert DataFrame<a class=headerlink href=#insert-dataframe title="Permanent link">&para;</a></h3> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> <a href=#makeMetricUpdateUDF>creates a UDF</a> to update <a href=#numTargetRowsInserted>numTargetRowsInserted</a> metric.</p> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> left-anti joins the source <code>DataFrame</code> with the target <code>DataFrame</code> on the <a href=#condition>merge condition</a>. <code>writeInsertsOnlyWhenNoMatchedClauses</code> selects the output columns and uses <code>Dataset.filter</code> with the UDF.</p> <details class=note> <summary>Demo: Left-Anti Join</summary> <div class=highlight><pre><span></span><code><span class=kd>val</span><span class=w> </span><span class=n>source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nc>Seq</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>).</span><span class=n>toDF</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=c1>// (1)!</span>
<span class=kd>val</span><span class=w> </span><span class=n>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nc>Seq</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>).</span><span class=n>toDF</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=c1>// (2)!</span>
<span class=kd>val</span><span class=w> </span><span class=n>usingColumns</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nc>Seq</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=n>q</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>source</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=n>target</span><span class=p>,</span><span class=w> </span><span class=n>usingColumns</span><span class=p>,</span><span class=w> </span><span class=s>&quot;leftanti&quot;</span><span class=p>)</span><span class=w></span>
</code></pre></div> <ol> <li> <p>Equivalent to <code>spark.range(4)</code></p> <div class=highlight><pre><span></span><code>+---+
| id|
+---+
|  0|
|  1|
|  2|
|  3|
+---+
</code></pre></div> </li> <li> <p>Equivalent to <code>spark.range(3, 6)</code></p> <div class=highlight><pre><span></span><code>+---+
| id|
+---+
|  3|
|  4|
|  5|
+---+
</code></pre></div> </li> </ol> <div class=highlight><pre><span></span><code>scala&gt; q.show
+---+
| id|
+---+
|  0|
|  1|
|  2|
+---+
</code></pre></div> </details> <h3 id=writefiles><span id=writeInsertsOnlyWhenNoMatchedClauses-writeFiles> writeFiles<a class=headerlink href=#writefiles title="Permanent link">&para;</a></h3> <p><code>writeInsertsOnlyWhenNoMatchedClauses</code> requests the given <a href=../../../OptimisticTransaction/ >OptimisticTransaction</a> to <a href=../../../TransactionalWrite/#writeFiles>write out</a> the <a href=#writeInsertsOnlyWhenNoMatchedClauses-insertDf>insertDf</a> (possibly <a href=#repartitionIfNeeded>repartitionIfNeeded</a> on the <a href=../../../Metadata/#partitionColumns>partitionColumns</a> of the <a href=#targetFileIndex>target delta table</a>).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This step triggers a Spark write job (and this active <a href=../../../OptimisticTransaction/ >transaction</a> is marked as <a href=../../../TransactionalWrite/#hasWritten>hasWritten</a>).</p> </div> <h3 id=update-metrics><span id=writeInsertsOnlyWhenNoMatchedClauses-metrics> Update Metrics<a class=headerlink href=#update-metrics title="Permanent link">&para;</a></h3> <p>In the end, <code>writeInsertsOnlyWhenNoMatchedClauses</code> updates the <a href=#metrics>metrics</a>.</p> <h2 id=writing-out-merged-data><span id=writeAllChanges> Writing Out Merged Data<a class=headerlink href=#writing-out-merged-data title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>writeAllChanges</span><span class=p>(</span><span class=w></span>
<span class=w>  </span><span class=n>spark</span><span class=p>:</span><span class=w> </span><span class=nc>SparkSession</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=n>deltaTxn</span><span class=p>:</span><span class=w> </span><span class=nc>OptimisticTransaction</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=n>filesToRewrite</span><span class=p>:</span><span class=w> </span><span class=nc>Seq</span><span class=p>[</span><span class=nc>AddFile</span><span class=p>]):</span><span class=w> </span><span class=nc>Seq</span><span class=p>[</span><span class=nc>FileAction</span><span class=p>]</span><span class=w></span>
</code></pre></div> <p>In the end, <code>writeAllChanges</code> returns the <a href=../../../FileAction/ >FileAction</a>s (from <a href=../../../TransactionalWrite/#writeFiles>writing out data</a>).</p> <hr> <p><code>writeAllChanges</code> is used when:</p> <ul> <li><code>MergeIntoCommand</code> is <a href=#run>executed</a> (that is neither a <a href=#isSingleInsertOnly>single insert-only merge</a> nor <a href=../../../DeltaSQLConf/#MERGE_INSERT_ONLY_ENABLED>spark.databricks.delta.merge.optimizeInsertOnlyMerge.enabled</a> configuration property is enabled for which <a href=#writeInsertsOnlyWhenNoMatchedClauses>writeInsertsOnlyWhenNoMatchedClauses</a> is used instead)</li> </ul> <h3 id=targetoutputcols><span id=writeAllChanges-targetOutputCols> targetOutputCols<a class=headerlink href=#targetoutputcols title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> builds the target output schema (possibly with some <code>null</code>s for the target columns that are not in the current schema).</p> <h3 id=newtarget-query-plan><span id=writeAllChanges-newTarget> newTarget Query Plan<a class=headerlink href=#newtarget-query-plan title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> <a href=#buildTargetPlanWithFiles>builds a target logical query plan</a> for the given <code>filesToRewrite</code> <a href=../../../AddFile/ >AddFile</a>s.</p> <h3 id=join-type><span id=writeAllChanges-joinType> Join Type<a class=headerlink href=#join-type title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> determines the join type to use:</p> <ul> <li><code>rightOuter</code> for <a href=#isMatchedOnly>matched-only merge</a> with <a href=../../../DeltaSQLConf/#MERGE_MATCHED_ONLY_ENABLED>spark.databricks.delta.merge.optimizeMatchedOnlyMerge.enabled</a> configuration property enabled</li> <li><code>fullOuter</code> otherwise</li> </ul> <p><code>writeAllChanges</code> prints out the following DEBUG message to the logs:</p> <div class=highlight><pre><span></span><code>writeAllChanges using [joinType] join:
source.output: [outputSet]
target.output: [outputSet]
condition: [condition]
newTarget.output: [outputSet]
</code></pre></div> <h3 id=source-dataframe_1><span id=writeAllChanges-sourceDF> Source DataFrame<a class=headerlink href=#source-dataframe_1 title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> creates a source <code>DataFrame</code> for the <a href=#source>source</a> query plan and an extra column:</p> <ul> <li><code>_source_row_present_</code> with the value of an UDF that increments the <a href=#numSourceRowsInSecondScan>numSourceRowsInSecondScan</a> metric</li> </ul> <h3 id=new-target-dataframe><span id=writeAllChanges-targetDF> New Target DataFrame<a class=headerlink href=#new-target-dataframe title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> creates a target <code>DataFrame</code> for the <a href=#writeAllChanges-newTarget>newTarget</a> query plan and an extra column:</p> <ul> <li><code>_target_row_present_</code> with <code>true</code> literal</li> </ul> <h3 id=joined-dataframe><span id=writeAllChanges-joinedDF> Joined DataFrame<a class=headerlink href=#joined-dataframe title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> creates a joined <code>DataFrame</code> that is a <code>Dataset.join</code> of the source and new target <code>DataFrame</code>s with the given <a href=#condition>join condition</a> and the <a href=#writeAllChanges-joinType>join type</a>.</p> <h3 id=output-schema><span id=writeAllChanges-outputRowSchema> Output Schema<a class=headerlink href=#output-schema title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> creates an output schema based on <a href=../../../change-data-feed/CDCReader/#isCDCEnabledOnTable>cdcEnabled</a>:</p> <ul> <li>FIXME</li> </ul> <h3 id=create-joinedrowprocessor><span id=writeAllChanges-processor> Create JoinedRowProcessor<a class=headerlink href=#create-joinedrowprocessor title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> creates a <a href=../JoinedRowProcessor/ >JoinedRowProcessor</a> (that is then used to map over partitions of the <a href=#writeAllChanges-joinedDF>joined DataFrame</a>).</p> <h3 id=output-dataframe><span id=writeAllChanges-outputDF> Output DataFrame<a class=headerlink href=#output-dataframe title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> creates a <code>DataFrame</code> for the <code>joinedPlan</code> and uses <code>Dataset.mapPartitions</code> operator to let the <a href=#writeAllChanges-processor>JoinedRowProcessor</a> to <a href=../JoinedRowProcessor/#processPartition>processPartition</a>.</p> <p><code>writeAllChanges</code> drops <a href=#ROW_DROPPED_COL><em>row_dropped</em></a> and <a href=#INCR_ROW_COUNT_COL><em>incr_row_count</em></a> columns.</p> <p><code>writeAllChanges</code> prints out the following DEBUG message to the logs:</p> <div class=highlight><pre><span></span><code>writeAllChanges: join output plan:
[outputDF.queryExecution]
</code></pre></div> <h3 id=writefiles_1><span id=writeAllChanges-newFiles> writeFiles<a class=headerlink href=#writefiles_1 title="Permanent link">&para;</a></h3> <p><code>writeAllChanges</code> requests the given <a href=../../../OptimisticTransaction/ >OptimisticTransaction</a> to <a href=../../../TransactionalWrite/#writeFiles>write out</a> the <a href=#writeInsertsOnlyWhenNoMatchedClauses-insertDf>insertDf</a> (possibly <a href=#repartitionIfNeeded>repartitioning if needed</a> on the <a href=../../../Metadata/#partitionColumns>partition columns</a>).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This step triggers a Spark write job (and this active <a href=../../../OptimisticTransaction/ >transaction</a> is marked as <a href=../../../TransactionalWrite/#hasWritten>hasWritten</a>).</p> </div> <h3 id=update-metrics_1><span id=writeAllChanges-metrics> Update Metrics<a class=headerlink href=#update-metrics_1 title="Permanent link">&para;</a></h3> <p>In the end, <code>writeAllChanges</code> updates the <a href=#metrics>metrics</a>.</p> <h2 id=single-insert-only-merge_1><span id=isSingleInsertOnly> Single Insert-Only Merge<a class=headerlink href=#single-insert-only-merge_1 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>isSingleInsertOnly</span><span class=p>:</span><span class=w> </span><span class=nc>Boolean</span><span class=w></span>
</code></pre></div> <p><code>isSingleInsertOnly</code> holds true when this <code>MERGE</code> command is a single <code>WHEN NOT MATCHED THEN INSERT</code>:</p> <ol> <li>No <a href=#matchedClauses>MATCHED clauses</a></li> <li>There is just a single <a href=#notMatchedClauses>notMatchedClauses</a></li> </ol> <div class=highlight><pre><span></span><code><span class=n>MERGE</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>merge_demo</span><span class=w> </span><span class=k>to</span><span class=w></span>
<span class=k>USING</span><span class=w> </span><span class=n>merge_demo_source</span><span class=w> </span><span class=k>from</span><span class=w></span>
<span class=k>ON</span><span class=w> </span><span class=k>to</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>from</span><span class=p>.</span><span class=n>id</span><span class=w></span>
<span class=k>WHEN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>MATCHED</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=o>*</span><span class=p>;</span><span class=w></span>
</code></pre></div> <h2 id=matched-only-merge><span id=isMatchedOnly> Matched-Only Merge<a class=headerlink href=#matched-only-merge title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>isMatchedOnly</span><span class=p>:</span><span class=w> </span><span class=nc>Boolean</span><span class=w></span>
</code></pre></div> <p><code>isMatchedOnly</code> holds true when this <code>MERGE</code> command is <code>WHEN MATCHED THEN</code>-only:</p> <ol> <li>No <a href=#notMatchedClauses>NOT MATCHED clauses</a></li> <li><a href=#matchedClauses>MATCHED clauses</a> only</li> </ol> <div class=highlight><pre><span></span><code><span class=n>MERGE</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>merge_demo</span><span class=w> </span><span class=k>to</span><span class=w></span>
<span class=k>USING</span><span class=w> </span><span class=n>merge_demo_source</span><span class=w> </span><span class=k>from</span><span class=w></span>
<span class=k>ON</span><span class=w> </span><span class=k>to</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>from</span><span class=p>.</span><span class=n>id</span><span class=w></span>
<span class=k>WHEN</span><span class=w> </span><span class=n>MATCHED</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>to</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=k>DELETE</span><span class=w></span>
<span class=k>WHEN</span><span class=w> </span><span class=n>MATCHED</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=o>*</span><span class=p>;</span><span class=w></span>
</code></pre></div> <h2 id=creating-metric-update-udf><span id=makeMetricUpdateUDF> Creating Metric Update UDF<a class=headerlink href=#creating-metric-update-udf title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>makeMetricUpdateUDF</span><span class=p>(</span><span class=w></span>
<span class=w>  </span><span class=n>name</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=p>):</span><span class=w> </span><span class=nc>Expression</span><span class=w></span>
</code></pre></div> <p><code>makeMetricUpdateUDF</code> looks up the performance metric (by <code>name</code>) in the <a href=#metrics>metrics</a>.</p> <p>In the end, <code>makeMetricUpdateUDF</code> defines a non-deterministic UDF to increment the metric (when executed).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This <code>Expression</code> is used to increment the following performance metrics:</p> <ul> <li><a href=#numSourceRows>number of source rows</a></li> <li><a href=#numSourceRowsInSecondScan>numSourceRowsInSecondScan</a></li> <li><a href=#numTargetRowsCopied>number of target rows rewritten unmodified</a></li> <li><a href=#numTargetRowsDeleted>number of deleted rows</a></li> <li><a href=#numTargetRowsInserted>number of inserted rows</a></li> <li><a href=#numTargetRowsUpdated>number of updated rows</a></li> </ul> </div> <p><code>makeMetricUpdateUDF</code> is used when:</p> <ul> <li><code>MergeIntoCommand</code> is requested to <a href=#findTouchedFiles>findTouchedFiles</a>, <a href=#writeInsertsOnlyWhenNoMatchedClauses>writeInsertsOnlyWhenNoMatchedClauses</a>, <a href=#writeAllChanges>writeAllChanges</a></li> </ul> <h2 id=notmatchedclauseoutput><span id=notMatchedClauseOutput> notMatchedClauseOutput<a class=headerlink href=#notmatchedclauseoutput title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>notMatchedClauseOutput</span><span class=p>(</span><span class=w></span>
<span class=w>  </span><span class=n>clause</span><span class=p>:</span><span class=w> </span><span class=nc>DeltaMergeIntoInsertClause</span><span class=p>):</span><span class=w> </span><span class=nc>Seq</span><span class=p>[</span><span class=nc>Seq</span><span class=p>[</span><span class=nc>Expression</span><span class=p>]]</span><span class=w></span>
</code></pre></div> <p><code>notMatchedClauseOutput</code> returns the main data output followed by the CDF data output when <a href=../../../change-data-feed/CDCReader/#isCDCEnabledOnTable>cdcEnabled</a>:</p> <div class=highlight><pre><span></span><code>(mainDataOutput)
</code></pre></div> <p>or</p> <div class=highlight><pre><span></span><code>(mainDataOutput, insertCdcOutput)
</code></pre></div> <hr> <p><code>notMatchedClauseOutput</code> creates the output (resolved expressions) of the main data based on the following:</p> <ol> <li>The <code>Expression</code>s from the <a href=../DeltaMergeIntoClause/#resolvedActions>DeltaMergeActions</a> of the given <a href=../DeltaMergeIntoInsertClause/ >DeltaMergeIntoInsertClause</a></li> <li><code>FalseLiteral</code></li> <li>The UDF to increment the <a href=#numTargetRowsInserted>numTargetRowsInserted</a> metric</li> <li><a href=../../../change-data-feed/CDCReader/#CDC_TYPE_NOT_CDC>null</a> literal (to indicate the main data not CDF's)</li> </ol> <p>With <a href=../../../change-data-feed/CDCReader/#isCDCEnabledOnTable>cdcEnabled</a>, <code>notMatchedClauseOutput</code> creates the output (resolved expressions) of the CDF data based on the following:</p> <ol> <li>The <code>Expression</code>s from the <a href=../DeltaMergeIntoClause/#resolvedActions>DeltaMergeActions</a> of the given <a href=../DeltaMergeIntoInsertClause/ >DeltaMergeIntoInsertClause</a></li> <li><code>FalseLiteral</code></li> <li><code>TrueLiteral</code></li> <li><a href=../../../change-data-feed/CDCReader/#CDC_TYPE_INSERT>insert</a> literal</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The first two expressions are the same in the main data and CDF data outputs.</p> </div> <hr> <p><code>notMatchedClauseOutput</code> is used when:</p> <ul> <li><code>MergeIntoCommand</code> is requested to <a href=#writeAllChanges>write out merged data</a> (for <a href=../JoinedRowProcessor/#notMatchedOutputs>notMatchedOutputs</a> to create a <a href=../JoinedRowProcessor/ >JoinedRowProcessor</a> based on the <a href=#notMatchedClauses>non-matched insert clauses</a>)</li> </ul> <h2 id=finding-files-to-rewrite><span id=findTouchedFiles> Finding Files to Rewrite<a class=headerlink href=#finding-files-to-rewrite title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>findTouchedFiles</span><span class=p>(</span><span class=w></span>
<span class=w>  </span><span class=n>spark</span><span class=p>:</span><span class=w> </span><span class=nc>SparkSession</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=n>deltaTxn</span><span class=p>:</span><span class=w> </span><span class=nc>OptimisticTransaction</span><span class=p>):</span><span class=w> </span><span class=nc>Seq</span><span class=p>[</span><span class=nc>AddFile</span><span class=p>]</span><span class=w></span>
</code></pre></div> <div class="admonition important"> <p class=admonition-title>Important</p> <p><code>findTouchedFiles</code> is such a fine piece of art (<em>a Delta gem</em>). It uses a custom accumulator, a UDF (to use this accumulator to record touched file names) and <code>input_file_name()</code> standard function for the names of the files read.</p> <p>It is always worth keeping in mind that Delta Lake uses files for data storage and that is why <code>input_file_name()</code> standard function works. It would not work for non-file-based data sources.</p> </div> <details class=note> <summary>Example 1: Understanding the Internals of <code>findTouchedFiles</code></summary> <p>The following query writes out a 10-element dataset using the default parquet data source to <code>/tmp/parquet</code> directory:</p> <div class=highlight><pre><span></span><code><span class=kd>val</span><span class=w> </span><span class=n>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;/tmp/parquet&quot;</span><span class=w></span>
<span class=n>spark</span><span class=p>.</span><span class=n>range</span><span class=p>(</span><span class=mi>10</span><span class=p>).</span><span class=n>write</span><span class=p>.</span><span class=n>save</span><span class=p>(</span><span class=n>target</span><span class=p>)</span><span class=w></span>
</code></pre></div> <p>The number of parquet part files varies based on the number of partitions (CPU cores).</p> <p>The following query loads the parquet dataset back alongside <code>input_file_name()</code> standard function to mimic <code>findTouchedFiles</code>'s behaviour.</p> <div class=highlight><pre><span></span><code><span class=kd>val</span><span class=w> </span><span class=nc>FILE_NAME_COL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;_file_name_&quot;</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=n>dataFiles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>spark</span><span class=p>.</span><span class=n>read</span><span class=p>.</span><span class=n>parquet</span><span class=p>(</span><span class=n>target</span><span class=p>).</span><span class=n>withColumn</span><span class=p>(</span><span class=nc>FILE_NAME_COL</span><span class=p>,</span><span class=w> </span><span class=n>input_file_name</span><span class=p>())</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code>scala&gt; dataFiles.show(truncate = false)
+---+---------------------------------------------------------------------------------------+
|id |_file_name_                                                                            |
+---+---------------------------------------------------------------------------------------+
|4  |file:///tmp/parquet/part-00007-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|0  |file:///tmp/parquet/part-00001-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|3  |file:///tmp/parquet/part-00006-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|6  |file:///tmp/parquet/part-00011-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|1  |file:///tmp/parquet/part-00003-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|8  |file:///tmp/parquet/part-00014-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|2  |file:///tmp/parquet/part-00004-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|7  |file:///tmp/parquet/part-00012-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|5  |file:///tmp/parquet/part-00009-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
|9  |file:///tmp/parquet/part-00015-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
+---+---------------------------------------------------------------------------------------+
</code></pre></div> <p>As you may have thought, not all part files have got data and so they are not included in the dataset. That is when <code>findTouchedFiles</code> uses <code>groupBy</code> operator and <code>count</code> action to calculate match frequency.</p> <div class=highlight><pre><span></span><code>val counts = dataFiles.groupBy(FILE_NAME_COL).count()
scala&gt; counts.show(truncate = false)
+---------------------------------------------------------------------------------------+-----+
|_file_name_                                                                            |count|
+---------------------------------------------------------------------------------------+-----+
|file:///tmp/parquet/part-00015-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00007-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00003-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00011-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00012-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00006-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00001-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00004-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00009-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
|file:///tmp/parquet/part-00014-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1    |
+---------------------------------------------------------------------------------------+-----+
</code></pre></div> <p>Let's load all the part files in the <code>/tmp/parquet</code> directory and find which file(s) have no data.</p> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>scala</span><span class=p>.</span><span class=nn>sys</span><span class=p>.</span><span class=nn>process</span><span class=p>.</span><span class=n>_</span>
<span class=kd>val</span><span class=w> </span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=s>s&quot;ls </span><span class=si>$</span><span class=n>target</span><span class=s>&quot;</span><span class=w> </span><span class=o>#|</span><span class=w> </span><span class=s>&quot;grep .parquet&quot;</span><span class=p>).</span><span class=n>lineStream</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=n>allFiles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cmd</span><span class=p>.</span><span class=n>toArray</span><span class=p>.</span><span class=n>toSeq</span><span class=p>.</span><span class=n>toDF</span><span class=p>(</span><span class=nc>FILE_NAME_COL</span><span class=p>)</span><span class=w></span>
<span class=w>  </span><span class=p>.</span><span class=n>select</span><span class=p>(</span><span class=n>concat</span><span class=p>(</span><span class=n>lit</span><span class=p>(</span><span class=s>s&quot;file://</span><span class=si>$</span><span class=n>target</span><span class=s>/&quot;</span><span class=p>),</span><span class=w> </span><span class=n>col</span><span class=p>(</span><span class=nc>FILE_NAME_COL</span><span class=p>))</span><span class=w> </span><span class=n>as</span><span class=w> </span><span class=nc>FILE_NAME_COL</span><span class=p>)</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=n>joinType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;left_anti&quot;</span><span class=w> </span><span class=c1>// MergeIntoCommand uses inner as it wants data file</span>
<span class=kd>val</span><span class=w> </span><span class=n>noDataFiles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>allFiles</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=n>dataFiles</span><span class=p>,</span><span class=w> </span><span class=nc>Seq</span><span class=p>(</span><span class=nc>FILE_NAME_COL</span><span class=p>),</span><span class=w> </span><span class=n>joinType</span><span class=p>)</span><span class=w></span>
</code></pre></div> <p>Mind that the data vs non-data datasets could be different, but that should not "interfere" with the main reasoning flow.</p> <div class=highlight><pre><span></span><code>scala&gt; noDataFiles.show(truncate = false)
+---------------------------------------------------------------------------------------+
|_file_name_                                                                            |
+---------------------------------------------------------------------------------------+
|file:///tmp/parquet/part-00000-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|
+---------------------------------------------------------------------------------------+
</code></pre></div> </details> <p><code>findTouchedFiles</code> registers an accumulator to collect all the distinct files that need to be rewritten (<em>touched files</em>).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The name of the accumulator is <strong>internal.metrics.MergeIntoDelta.touchedFiles</strong> and <code>internal.metrics</code> part is supposed to hide it from web UI as potentially large (set of file names to be rewritten).</p> </div> <h3 id=recordtouchedfilename><span id=findTouchedFiles-recordTouchedFileName> recordTouchedFileName<a class=headerlink href=#recordtouchedfilename title="Permanent link">&para;</a></h3> <p><code>findTouchedFiles</code> defines a nondeterministic UDF that adds the file names to the accumulator (<em>recordTouchedFileName</em>).</p> <h3 id=dataskippedfiles><span id=findTouchedFiles-dataSkippedFiles> dataSkippedFiles<a class=headerlink href=#dataskippedfiles title="Permanent link">&para;</a></h3> <p><code>findTouchedFiles</code> splits conjunctive predicates (<code>And</code> binary expressions) in the <a href=#condition>condition</a> expression and collects the predicates that use the <a href=#target>target</a>'s columns (<em>targetOnlyPredicates</em>). <code>findTouchedFiles</code> requests the given <a href=../../../OptimisticTransaction/ >OptimisticTransaction</a> for the <a href=../../../OptimisticTransactionImpl/#filterFiles>files that match the target-only predicates</a> (and creates a <code>dataSkippedFiles</code> collection of <a href=../../../AddFile/ >AddFile</a>s).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This step looks similar to <strong>filter predicate pushdown</strong>.</p> </div> <p><code>findTouchedFiles</code> creates one <code>DataFrame</code> for the <a href=#source>source data</a> (using <a href=https://books.japila.pl/spark-sql-internals/Dataset/#ofRows>Spark SQL</a> utility).</p> <p><code>findTouchedFiles</code> <a href=#buildTargetPlanWithFiles>builds a logical query plan</a> for the files (matching the predicates) and creates another <code>DataFrame</code> for the target data. <code>findTouchedFiles</code> adds two columns to the target dataframe:</p> <ol> <li><code>_row_id_</code> for <code>monotonically_increasing_id()</code> standard function</li> <li><code>_file_name_</code> for <code>input_file_name()</code> standard function</li> </ol> <p><code>findTouchedFiles</code> creates (a <code>DataFrame</code> that is) an INNER JOIN of the source and target <code>DataFrame</code>s using the <a href=#condition>condition</a> expression.</p> <p><code>findTouchedFiles</code> takes the joined dataframe and selects <code>_row_id_</code> column and the <a href=#findTouchedFiles-recordTouchedFileName>recordTouchedFileName</a> UDF on the <code>_file_name_</code> column as <code>one</code>. The <code>DataFrame</code> is internally known as <code>collectTouchedFiles</code>.</p> <p><code>findTouchedFiles</code> uses <code>groupBy</code> operator on <code>_row_id_</code> to calculate a sum of all the values in the <code>one</code> column (as <code>count</code> column) in the two-column <code>collectTouchedFiles</code> dataset. The <code>DataFrame</code> is internally known as <code>matchedRowCounts</code>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>No Spark job has been submitted yet. <code>findTouchedFiles</code> is still in "query preparation" mode.</p> </div> <p><code>findTouchedFiles</code> uses <code>filter</code> on the <code>count</code> column (in the <code>matchedRowCounts</code> dataset) with values greater than <code>1</code>. If there are any, <code>findTouchedFiles</code> throws an <code>UnsupportedOperationException</code> exception:</p> <div class=highlight><pre><span></span><code>Cannot perform MERGE as multiple source rows matched and attempted to update the same
target row in the Delta table. By SQL semantics of merge, when multiple source rows match
on the same target row, the update operation is ambiguous as it is unclear which source
should be used to update the matching target row.
You can preprocess the source table to eliminate the possibility of multiple matches.
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Since <code>findTouchedFiles</code> uses <code>count</code> action there should be a Spark SQL query reported (and possibly Spark jobs) in web UI.</p> </div> <p><code>findTouchedFiles</code> requests the <code>touchedFilesAccum</code> accumulator for the touched file names.</p> <details class=note> <summary>Example 2: Understanding the Internals of <code>findTouchedFiles</code></summary> <div class=highlight><pre><span></span><code><span class=kd>val</span><span class=w> </span><span class=nc>TOUCHED_FILES_ACCUM_NAME</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;MergeIntoDelta.touchedFiles&quot;</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=n>touchedFilesAccum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>spark</span><span class=p>.</span><span class=n>sparkContext</span><span class=p>.</span><span class=n>collectionAccumulator</span><span class=p>[</span><span class=nc>String</span><span class=p>](</span><span class=nc>TOUCHED_FILES_ACCUM_NAME</span><span class=p>)</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=n>recordTouchedFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>udf</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>(</span><span class=n>fileName</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>touchedFilesAccum</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=n>fileName</span><span class=p>)</span><span class=w></span>
<span class=w>  </span><span class=mi>1</span><span class=w></span>
<span class=p>}}.</span><span class=n>asNondeterministic</span><span class=p>()</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kd>val</span><span class=w> </span><span class=n>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;/tmp/parquet&quot;</span><span class=w></span>
<span class=n>spark</span><span class=p>.</span><span class=n>range</span><span class=p>(</span><span class=mi>10</span><span class=p>).</span><span class=n>write</span><span class=p>.</span><span class=n>save</span><span class=p>(</span><span class=n>target</span><span class=p>)</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kd>val</span><span class=w> </span><span class=nc>FILE_NAME_COL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;_file_name_&quot;</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=n>dataFiles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>spark</span><span class=p>.</span><span class=n>read</span><span class=p>.</span><span class=n>parquet</span><span class=p>(</span><span class=n>target</span><span class=p>).</span><span class=n>withColumn</span><span class=p>(</span><span class=nc>FILE_NAME_COL</span><span class=p>,</span><span class=w> </span><span class=n>input_file_name</span><span class=p>())</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=n>collectTouchedFiles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dataFiles</span><span class=p>.</span><span class=n>select</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=nc>FILE_NAME_COL</span><span class=p>),</span><span class=w> </span><span class=n>recordTouchedFileName</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=nc>FILE_NAME_COL</span><span class=p>)).</span><span class=n>as</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>))</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code>scala&gt; collectTouchedFiles.show(truncate = false)
+---------------------------------------------------------------------------------------+---+
|_file_name_                                                                            |one|
+---------------------------------------------------------------------------------------+---+
|file:///tmp/parquet/part-00007-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00001-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00006-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00011-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00003-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00014-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00004-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00012-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00009-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
|file:///tmp/parquet/part-00015-76df546f-91f8-4cbb-8fcc-f51478e0db31-c000.snappy.parquet|1  |
+---------------------------------------------------------------------------------------+---+    
</code></pre></div> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>scala</span><span class=p>.</span><span class=nn>collection</span><span class=p>.</span><span class=nc>JavaConverters</span><span class=p>.</span><span class=n>_</span>
<span class=kd>val</span><span class=w> </span><span class=n>touchedFileNames</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>touchedFilesAccum</span><span class=p>.</span><span class=n>value</span><span class=p>.</span><span class=n>asScala</span><span class=p>.</span><span class=n>toSeq</span><span class=w></span>
</code></pre></div> <p>Use the Stages tab in web UI to review the accumulator values.</p> </details> <p><code>findTouchedFiles</code> prints out the following TRACE message to the logs:</p> <div class=highlight><pre><span></span><code>findTouchedFiles: matched files:
  [touchedFileNames]
</code></pre></div> <p><code>findTouchedFiles</code> <a href=#generateCandidateFileMap>generateCandidateFileMap</a> for the <a href=#findTouchedFiles-dataSkippedFiles>files that match the target-only predicates</a>.</p> <p><code>findTouchedFiles</code> <a href=#getTouchedFile>getTouchedFile</a> for every touched file name.</p> <p><code>findTouchedFiles</code> updates the following performance metrics:</p> <ul> <li><a href=#numTargetFilesBeforeSkipping>numTargetFilesBeforeSkipping</a> and adds the <a href=#numOfFiles>numOfFiles</a> of the <a href=../../../OptimisticTransaction/#snapshot>Snapshot</a> of the given <a href=../../../OptimisticTransaction/ >OptimisticTransaction</a></li> <li><a href=#numTargetFilesAfterSkipping>numTargetFilesAfterSkipping</a> and adds the number of the <a href=#findTouchedFiles-dataSkippedFiles>files that match the target-only predicates</a></li> <li><a href=#numTargetFilesRemoved>numTargetFilesRemoved</a> and adds the number of the touched files</li> </ul> <p>In the end, <code>findTouchedFiles</code> gives the touched files (as <a href=../../../AddFile/ >AddFile</a>s).</p> <h2 id=repartitionifneeded><span id=repartitionIfNeeded> repartitionIfNeeded<a class=headerlink href=#repartitionifneeded title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>repartitionIfNeeded</span><span class=p>(</span><span class=w></span>
<span class=w>  </span><span class=n>spark</span><span class=p>:</span><span class=w> </span><span class=nc>SparkSession</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=n>df</span><span class=p>:</span><span class=w> </span><span class=nc>DataFrame</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=n>partitionColumns</span><span class=p>:</span><span class=w> </span><span class=nc>Seq</span><span class=p>[</span><span class=nc>String</span><span class=p>]):</span><span class=w> </span><span class=nc>DataFrame</span><span class=w></span>
</code></pre></div> <p><code>repartitionIfNeeded</code> repartitions the given <code>DataFrame</code> by the <code>partitionColumns</code> (using <code>Dataset.repartition</code> operation) when all the following hold:</p> <ol> <li>There is at least one partition column (among the given <code>partitionColumns</code>)</li> <li><a href=../../../DeltaSQLConf/#MERGE_REPARTITION_BEFORE_WRITE>spark.databricks.delta.merge.repartitionBeforeWrite.enabled</a> configuration property is <code>true</code></li> </ol> <hr> <p><code>repartitionIfNeeded</code> is used when:</p> <ul> <li><code>MergeIntoCommand</code> is <a href=#run>executed</a> (and <a href=../../../TransactionalWrite/#writeFiles>writes data out</a> for <a href=#writeInsertsOnlyWhenNoMatchedClauses>Single Insert-Only Merge</a> and <a href=#writeAllChanges>other merges</a>)</li> </ul> <h2 id=leafrunnablecommand><span id=LeafRunnableCommand> LeafRunnableCommand<a class=headerlink href=#leafrunnablecommand title="Permanent link">&para;</a></h2> <p><code>MergeIntoCommand</code> is a <code>LeafRunnableCommand</code> (<a href=https://books.japila.pl/spark-sql-internals/logical-operators/LeafRunnableCommand/ >Spark SQL</a>) logical operator.</p> <h2 id=demo>Demo<a class=headerlink href=#demo title="Permanent link">&para;</a></h2> <p><a href=../../../demo/merge-operation/ >Demo: Merge Operation</a>.</p> <h2 id=logging>Logging<a class=headerlink href=#logging title="Permanent link">&para;</a></h2> <p>Enable <code>ALL</code> logging level for <code>org.apache.spark.sql.delta.commands.MergeIntoCommand</code> logger to see what happens inside.</p> <p>Add the following line to <code>conf/log4j.properties</code>:</p> <div class=highlight><pre><span></span><code>log4j.logger.org.apache.spark.sql.delta.commands.MergeIntoCommand=ALL
</code></pre></div> <p>Refer to <a href=../../../spark-logging/ >Logging</a>.</p> </article> <script>var input,hash=location.hash.slice(1);hash.startsWith("__tabbed_")&&((input=document.getElementById(hash)).checked=!0)</script> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../JoinedRowProcessor/ class="md-footer__link md-footer__link--prev" aria-label="Previous: JoinedRowProcessor" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> JoinedRowProcessor </div> </div> </a> <a href=../../optimize/ class="md-footer__link md-footer__link--next" aria-label="Next: OPTIMIZE Command" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> OPTIMIZE Command </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 Jacek Laskowski </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs Insiders </a> </div> <div class=md-social> <a href=https://github.com/jaceklaskowski target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/jaceklaskowski target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/jaceklaskowski target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.720157f5.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.15234abc.min.js></script> </body> </html>